"use strict";(self.webpackChunkims=self.webpackChunkims||[]).push([[6531],{6531:(H,F,i)=>{i.d(F,{t:()=>X});var e=i(7705),c=i(177),a=i(9417),b=i(353),R=i(9475),D=i(7109),p=i(5088),_=i(4774),d=i(3040),T=i(4177),h=i(4958),O=i(6475),C=i(5816),v=i(6504),f=i(7529),y=i(6389),z=i(5703),k=i(9448),m=i(8927),E=i(1011),g=i(1997),j=i(9397),P=i(6122);function L(n,s){if(1&n&&(e.qex(0),e.nrm(1,"nz-option",32),e.bVm()),2&n){const t=s.$implicit;e.R7$(1),e.Y8G("nzLabel",t.label)("nzValue",t.value)}}function G(n,s){if(1&n&&e.nrm(0,"nz-option",33),2&n){const t=s.$implicit;e.Y8G("nzValue",t.value)("nzLabel",t.label)}}function S(n,s){if(1&n&&e.nrm(0,"nz-option",33),2&n){const t=s.$implicit;e.Y8G("nzValue",t.value)("nzLabel",t.label)}}function A(n,s){if(1&n&&(e.j41(0,"p",40),e.EFF(1),e.k0s()),2&n){const t=e.XpG().$implicit,r=e.XpG();e.R7$(1),e.SpI("",r.getProductName(t.product_oid)," ")}}function I(n,s){if(1&n&&(e.j41(0,"div",41)(1,"p",42),e.EFF(2,"Quantity: "),e.j41(3,"span",22),e.EFF(4),e.k0s()(),e.j41(5,"p",42),e.EFF(6,"Unit Price: "),e.j41(7,"span",22),e.EFF(8),e.k0s()(),e.j41(9,"p",42),e.EFF(10,"Total Price: "),e.j41(11,"span",22),e.EFF(12),e.k0s()(),e.j41(13,"p",42),e.EFF(14,"Warehouse: "),e.j41(15,"span",22),e.EFF(16),e.k0s()()()),2&n){const t=e.XpG().$implicit,r=e.XpG();e.R7$(4),e.JRh(t.quantity),e.R7$(4),e.SpI("\u09f3",t.unit_price,""),e.R7$(4),e.SpI("\u09f3",r.calculateTotalPrice(t),""),e.R7$(4),e.JRh(r.getWarehouseName(t.warehouse_oid))}}function M(n,s){if(1&n){const t=e.RV6();e.j41(0,"span",44),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2).index,l=e.XpG();return e.Njj(l.handleItemDelete(o))}),e.k0s()}}function V(n,s){if(1&n&&e.DNE(0,M,1,0,"span",43),2&n){const t=e.XpG().$implicit;e.Y8G("ngIf",!t.oid)}}function N(n,s){if(1&n){const t=e.RV6();e.j41(0,"span",45),e.bIt("click",function(){e.eBV(t);const o=e.XpG().index,l=e.XpG();return e.Njj(l.handleItemEdit(o))}),e.k0s()}}const $=function(n,s){return[n,s]};function w(n,s){if(1&n&&(e.qex(0),e.j41(1,"nz-card",34),e.nrm(2,"nz-card-meta",35),e.k0s(),e.DNE(3,A,2,1,"ng-template",null,36,e.C5r),e.DNE(5,I,17,4,"ng-template",null,37,e.C5r),e.DNE(7,V,1,1,"ng-template",null,38,e.C5r),e.DNE(9,N,1,0,"ng-template",null,39,e.C5r),e.bVm()),2&n){const t=e.sdS(4),r=e.sdS(6),o=e.sdS(8),l=e.sdS(10);e.R7$(1),e.Y8G("nzActions",e.l_i(3,$,o,l))("nzTitle",t),e.R7$(1),e.Y8G("nzDescription",r)}}function U(n,s){if(1&n){const t=e.RV6();e.j41(0,"div",46),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleAdd())}),e.j41(1,"div"),e.nrm(2,"svg-icon",47),e.k0s()()}}function W(n,s){if(1&n&&(e.qex(0),e.nrm(1,"nz-option",59),e.bVm()),2&n){const t=s.$implicit,r=e.XpG(2);e.R7$(1),e.Y8G("nzDisabled",r.checkDisabledStatus(t.value))("nzLabel",t.label)("nzValue",t.value)}}function Y(n,s){if(1&n&&(e.qex(0),e.nrm(1,"nz-option",32),e.bVm()),2&n){const t=s.$implicit;e.R7$(1),e.Y8G("nzLabel",t.label)("nzValue",t.value)}}function q(n,s){if(1&n&&(e.qex(0),e.nrm(1,"nz-option",32),e.bVm()),2&n){const t=s.$implicit;e.R7$(1),e.Y8G("nzLabel",t.label)("nzValue",t.value)}}function B(n,s){if(1&n){const t=e.RV6();e.j41(0,"form",1),e.bIt("ngSubmit",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleDrawerForm())}),e.j41(1,"div",48)(2,"nz-form-item")(3,"nz-form-label",6),e.EFF(4,"Product"),e.k0s(),e.j41(5,"nz-form-control",49)(6,"nz-select",50),e.DNE(7,W,2,3,"ng-container",9),e.k0s()()(),e.j41(8,"nz-form-item")(9,"nz-form-label",6),e.EFF(10,"Warehouse"),e.k0s(),e.j41(11,"nz-form-control",51)(12,"nz-select",52),e.DNE(13,Y,2,2,"ng-container",9),e.k0s()()(),e.j41(14,"nz-form-item")(15,"nz-form-label",6),e.EFF(16,"Aisle"),e.k0s(),e.j41(17,"nz-form-control",53)(18,"nz-select",54),e.DNE(19,q,2,2,"ng-container",9),e.k0s()()(),e.j41(20,"nz-form-item")(21,"nz-form-label",6),e.EFF(22,"Quantity"),e.k0s(),e.j41(23,"nz-form-control",55),e.nrm(24,"input",56),e.k0s()(),e.j41(25,"nz-form-item")(26,"nz-form-label",6),e.EFF(27,"Unit Price"),e.k0s(),e.j41(28,"nz-form-control",57),e.nrm(29,"input",58),e.k0s()()()()}if(2&n){const t=e.XpG();e.Y8G("formGroup",t.drawerForm)("nzLayout","vertical"),e.R7$(3),e.Y8G("nzRequired",t.hasRequiredValidatorDrawerForm("product_oid")),e.R7$(4),e.Y8G("ngForOf",t.productList),e.R7$(2),e.Y8G("nzRequired",t.hasRequiredValidatorDrawerForm("warehouse_oid")),e.R7$(4),e.Y8G("ngForOf",t.warehouseList),e.R7$(2),e.Y8G("nzRequired",t.hasRequiredValidatorDrawerForm("aisle_oid")),e.R7$(4),e.Y8G("ngForOf",t.aisleList),e.R7$(2),e.Y8G("nzRequired",t.hasRequiredValidatorDrawerForm("quantity")),e.R7$(5),e.Y8G("nzRequired",t.hasRequiredValidatorDrawerForm("unit_price"))}}function x(n,s){if(1&n){const t=e.RV6();e.j41(0,"div",60)(1,"div",26)(2,"secondary-button",27),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.close())}),e.k0s(),e.j41(3,"primary-button",61),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleDrawerForm())}),e.k0s()()()}if(2&n){const t=e.XpG();e.R7$(2),e.Y8G("label","Cancel"),e.R7$(1),e.Y8G("label","Submit")("loading",t.loading)("type","button")}}const K=function(){return{overflow:"auto"}};let X=(()=>{class n{constructor(t,r,o,l,u){this._fb=t,this._modal=r,this._httpService=o,this._destroyRef=l,this._notificationService=u,this.actionEmitter=new e.bkB,this.loading=!1,this.supplierList=[],this.productList=[],this.warehouseList=[],this.aisleList=[],this.purchaseTypes=h.V.PURCHASE_TYPES,this.paymentStatuses=h.V.PAYMENT_STATUS,this.visible=!1,this.editIndex=null,this.currentTotalPrice=0}ngOnInit(){this.form=this.createForm(),this.drawerForm=this.createProductGroup(),this.loadSupplierList(),this.loadProductList(),this.loadWarehouseList(),this.formData&&(this.form.patchValue(this.formData),this.formData.products.forEach(t=>{const r=this.createProductGroup();r.patchValue(t),this.products.push(r),this.calculateTotalPriceFromProducts()})),this.form.get("payment_status")?.valueChanges.subscribe(t=>{const r=this.form.get("paid_amount");"paid"===t||"partially_paid"===t?r?.setValidators([a.k0.required,a.k0.min(.01)]):(r?.clearValidators(),r?.setValue(null)),r?.updateValueAndValidity()}),this.drawerForm.controls.warehouse_oid.valueChanges.subscribe(t=>{this.drawerForm.controls.aisle_oid.setValue(null),t?this.loadAisleList(t):this.aisleList=[]}),this.products.valueChanges.subscribe(()=>{this.calculateTotalPriceFromProducts()})}calculateTotalPriceFromProducts(){this.currentTotalPrice=this.products.value.reduce((r,o)=>r+(o.unit_price||0)*(o.quantity||0),0)}createForm(){return this._fb.group({oid:[null],supplier_oid:[null,a.k0.required],total_amount:[null,[a.k0.required,a.k0.min(.01)]],special_notes:[null],payment_status:[null,a.k0.required],paid_amount:[null,a.k0.min(0)],purchase_type:[null,a.k0.required],products:this._fb.array([])})}createProductGroup(){return this._fb.group({oid:[null],product_oid:[null,a.k0.required],warehouse_oid:[null,a.k0.required],aisle_oid:[null],quantity:[null,[a.k0.required,a.k0.min(1)]],unit_price:[null,[a.k0.required,a.k0.min(.01)]]})}get products(){return this.form.get("products")}addProduct(){this.products.push(this.createProductGroup())}removeProduct(t){this.products.length>1&&this.products.removeAt(t)}handleAdd(){this.visible=!0}handleConfirm(){let t="Are you sure you want to proceed with this purchase order?";this.formData&&(t="Are you sure you want to save these updates?"),this._modal.create({nzContent:T.M,nzData:{message:t},nzFooter:null,nzClosable:!1,nzOnOk:()=>this.actionEmitter.emit({action:"submit",value:this.form.value})})}handleForm(){this.form.valid?this.products.length?this.handleConfirm():this._notificationService.warning("Warning!","You have to add at lease 1 or more products!"):(0,d.N4)(this.form)}goBack(){this.actionEmitter.emit({action:"back",value:this.form.value})}close(){this.visible=!1}hasRequiredValidator(t){const r=this.form.get(t);return!!r&&(0,d.op)(r)}hasRequiredValidatorDrawerForm(t){const r=this.drawerForm.get(t);return!!r&&(0,d.op)(r)}checkDisabledStatus(t){return this.products.value.find(r=>r.product_oid===t)}handleDrawerForm(){if(this.drawerForm.valid){const t=this.drawerForm.value;null!==this.editIndex?(this.products.at(this.editIndex).patchValue(t),this.editIndex=null):this.products.push(this._fb.group({...t})),this.drawerForm.reset(),this.visible=!1}else(0,d.N4)(this.drawerForm)}getProductName(t){const r=this.productList.find(o=>o.value===t);return r?r.label:"Unknown Product"}getWarehouseName(t){const r=this.warehouseList.find(o=>o.value===t);return r?r.label:"Unknown Warehouse"}calculateTotalPrice(t){return t.unit_price||t.quantity?Number(t.unit_price)*Number(t.quantity):0}handleItemEdit(t){this.editIndex=t;const r=this.products.at(t).value;this.drawerForm.patchValue(r),this.visible=!0}handleItemDelete(t){this.products.removeAt(t)}loadSupplierList(){this._httpService.get(_.A.GET_SUPPLIER_LIST_FOR_DROPDOWN).subscribe({next:t=>{200===t.body.code&&(this.supplierList=t.body.data)},error:t=>{console.log(t)}})}loadProductList(){this.loading=!0,this._httpService.get(_.A.GET_PRODUCT_LIST_FOR_DROPDOWN).subscribe({next:t=>{this.loading=!1,200===t.body.code&&(this.productList=t.body.data)},error:()=>{this.loading=!1}})}loadWarehouseList(){this.loading=!0,this._httpService.get(_.A.GET_WAREHOUSE_LIST_FOR_DROPDOWN).subscribe({next:t=>{this.loading=!1,200===t.body.code&&(this.warehouseList=t.body.data)},error:()=>{this.loading=!1}})}loadAisleList(t){this._httpService.get(_.A.GET_AISLE_LIST_FOR_DROPDOWN,{warehouse_oid:t}).subscribe({next:r=>{this.aisleList=[],200===r.body.code&&(this.aisleList=r.body.data)},error:()=>{}})}static{this.\u0275fac=function(r){return new(r||n)(e.rXU(a.ok),e.rXU(O.N_),e.rXU(C.k),e.rXU(e.abz),e.rXU(v.xY))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-purchase-order-form"]],inputs:{formData:"formData",loading:"loading"},outputs:{actionEmitter:"actionEmitter"},standalone:!0,features:[e.aNF],decls:63,vars:26,consts:[[1,"rounded-md","bg-white"],["nz-form","",1,"space-y-4",3,"formGroup","nzLayout","ngSubmit"],[1,"border-[0.5px]","p-4","rounded-md"],[1,"text-xl","font-medium"],[1,"my-4"],[1,"grid","grid-cols-1","md:gap-x-6","md:grid-cols-2","lg:grid-cols-3"],[3,"nzRequired"],["nzErrorTip","Supplier is required."],["formControlName","supplier_oid","nz-input","","nzAllowClear","","nzPlaceHolder","Select Supplier",1,"w-full"],[4,"ngFor","ngForOf"],["nzErrorTip","Total Amount is Required."],["formControlName","total_amount","type","number","nz-input","","placeholder","Enter Total Amount"],["nzErrorTip","Purchase Type is Required."],["nzPlaceHolder","Select Purchase Type","formControlName","purchase_type",1,"w-full"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nzErrorTip","Payment Status is Required."],["nzPlaceHolder","Select Payment Status","formControlName","payment_status",1,"w-full"],["nzErrorTip","Paid Amount is Required."],["placeHolder","Enter Paid Amount (if needed)","formControlName","paid_amount","type","number","nz-input","",1,"w-full"],["nzErrorTip","Special Notes is Required."],["formControlName","special_notes","nz-input","","placeholder","Enter Special Notes (if any)","nzAutosize",""],[1,"flex","justify-between","items-center"],[1,"font-semibold"],[1,"grid","grid-cols-1","sm:grid-cols-2","md:grid-cols-5","gap-4"],["class","border border-[#C6C6C6] rounded-md shadow-lg p-4 flex items-center justify-center cursor-pointer hover:scale-95 transition-all duration-300 ease-in-out",3,"click",4,"ngIf"],[1,"flex","justify-end","mt-4"],[1,"flex","items-center","gap-4"],[3,"label","click"],[3,"label","loading","type"],["nzTitle","Product Details","nzSize","default",3,"nzBodyStyle","nzMaskClosable","nzVisible","nzFooter","nzOnClose"],["nz-form","","class","space-y-4",3,"formGroup","nzLayout","ngSubmit",4,"nzDrawerContent"],["footerTpl",""],[3,"nzLabel","nzValue"],[3,"nzValue","nzLabel"],[1,"shadow-lg",3,"nzActions","nzTitle"],[3,"nzDescription"],["titleTem",""],["descriptionTem",""],["actionSetting",""],["actionEdit",""],[1,"font-semibold","text-secondary"],[1,"space-y-1"],[1,"text-sm","font-light","text-secondary"],["nzType","delete","nzDanger","","nz-icon","",3,"click",4,"ngIf"],["nzType","delete","nzDanger","","nz-icon","",3,"click"],["nzType","edit","nz-icon","",3,"click"],[1,"border","border-[#C6C6C6]","rounded-md","shadow-lg","p-4","flex","items-center","justify-center","cursor-pointer","hover:scale-95","transition-all","duration-300","ease-in-out",3,"click"],["src","assets/icons/add_item.svg",1,"transition-transform","duration-150","ease-in-out"],[1,"grid","grid-cols-1"],["nzErrorTip","Product is required."],["formControlName","product_oid","nz-input","","nzAllowClear","","nzPlaceHolder","Select Product",1,"w-full"],["nzErrorTip","Warehouse is required."],["formControlName","warehouse_oid","nz-input","","nzAllowClear","","nzPlaceHolder","Select Warehouse",1,"w-full"],["nzErrorTip","Aisle is required."],["formControlName","aisle_oid","nz-input","","nzAllowClear","","nzPlaceHolder","Select Aisle",1,"w-full"],["nzErrorTip","Quantity is Required."],["formControlName","quantity","type","number","nz-input","","placeholder","Enter Quantity"],["nzErrorTip","Unit Price is Required."],["formControlName","unit_price","type","number","nz-input","","placeholder","Enter Unit Price"],[3,"nzDisabled","nzLabel","nzValue"],[2,"float","right"],[3,"label","loading","type","click"]],template:function(r,o){if(1&r&&(e.j41(0,"div",0)(1,"form",1),e.bIt("ngSubmit",function(){return o.handleForm()}),e.j41(2,"div",2)(3,"h2",3),e.EFF(4,"Purchase Details"),e.k0s(),e.nrm(5,"nz-divider",4),e.j41(6,"div",5)(7,"nz-form-item")(8,"nz-form-label",6),e.EFF(9,"Supplier"),e.k0s(),e.j41(10,"nz-form-control",7)(11,"nz-select",8),e.DNE(12,L,2,2,"ng-container",9),e.k0s()()(),e.j41(13,"nz-form-item")(14,"nz-form-label",6),e.EFF(15,"Total Amount"),e.k0s(),e.j41(16,"nz-form-control",10),e.nrm(17,"input",11),e.k0s()(),e.j41(18,"nz-form-item")(19,"nz-form-label",6),e.EFF(20,"Purchase Type"),e.k0s(),e.j41(21,"nz-form-control",12)(22,"nz-select",13),e.DNE(23,G,1,2,"nz-option",14),e.k0s()()(),e.j41(24,"nz-form-item")(25,"nz-form-label",6),e.EFF(26,"Payment Status"),e.k0s(),e.j41(27,"nz-form-control",15)(28,"nz-select",16),e.DNE(29,S,1,2,"nz-option",14),e.k0s()()(),e.j41(30,"nz-form-item")(31,"nz-form-label",6),e.EFF(32,"Paid Amount"),e.k0s(),e.j41(33,"nz-form-control",17),e.nrm(34,"input",18),e.k0s()(),e.j41(35,"nz-form-item")(36,"nz-form-label",6),e.EFF(37,"Special Notes"),e.k0s(),e.j41(38,"nz-form-control",19),e.nrm(39,"textarea",20),e.k0s()()()(),e.j41(40,"div",2)(41,"div",21)(42,"h2",3),e.EFF(43,"Products Information"),e.k0s(),e.j41(44,"p"),e.EFF(45,"Calculated Amount: \u09f3 "),e.j41(46,"span",22),e.EFF(47),e.k0s()()(),e.nrm(48,"nz-divider",4),e.j41(49,"div",23),e.DNE(50,w,11,6,"ng-container",9),e.DNE(51,U,3,0,"div",24),e.k0s()(),e.j41(52,"div",25)(53,"div",26)(54,"secondary-button",27),e.bIt("click",function(){return o.goBack()}),e.k0s(),e.nrm(55,"primary-button",28),e.k0s()()()(),e.j41(56,"nz-drawer",29),e.bIt("nzOnClose",function(){return o.close()}),e.j41(57,"pre"),e.EFF(58),e.nI1(59,"json"),e.k0s(),e.DNE(60,B,30,10,"form",30),e.k0s(),e.DNE(61,x,4,4,"ng-template",null,31,e.C5r)),2&r){const l=e.sdS(62);let u;e.R7$(1),e.Y8G("formGroup",o.form)("nzLayout","vertical"),e.R7$(7),e.Y8G("nzRequired",o.hasRequiredValidator("supplier_oid")),e.R7$(4),e.Y8G("ngForOf",o.supplierList),e.R7$(2),e.Y8G("nzRequired",o.hasRequiredValidator("total_amount")),e.R7$(5),e.Y8G("nzRequired",o.hasRequiredValidator("purchase_type")),e.R7$(4),e.Y8G("ngForOf",o.purchaseTypes),e.R7$(2),e.Y8G("nzRequired",o.hasRequiredValidator("payment_status")),e.R7$(4),e.Y8G("ngForOf",o.paymentStatuses),e.R7$(2),e.Y8G("nzRequired",o.hasRequiredValidator("paid_amount")),e.R7$(5),e.Y8G("nzRequired",o.hasRequiredValidator("special_notes")),e.R7$(11),e.JRh(o.currentTotalPrice),e.R7$(3),e.Y8G("ngForOf",null==(u=o.form.get("products"))?null:u.value),e.R7$(1),e.Y8G("ngIf",!o.formData),e.R7$(3),e.Y8G("label","Cancel"),e.R7$(1),e.Y8G("label","Submit")("loading",o.loading)("type","submit"),e.R7$(1),e.Y8G("nzBodyStyle",e.lJ4(25,K))("nzMaskClosable",!1)("nzVisible",o.visible)("nzFooter",l),e.R7$(2),e.JRh(e.bMT(59,23,o.drawerForm.value))}},dependencies:[c.MD,c.Sq,c.bT,c.TG,D.Z,f.Uq,f.e,y.c,z.cK,z.ls,k.j,m.CA,m.Ls,m.Mo,m.zS,E.Sy,E.c9,g.ld,g.WI,j.Dn,P.vg,P.wk,a.X1,a.qT,a.me,a.Q0,a.BC,a.cb,a.j4,a.JD,b.j,R.t,p.iu,p.DM]})}}return n})()}}]);