"use strict";(self.webpackChunkims=self.webpackChunkims||[]).push([[369],{369:(y,S,s)=>{s.r(S),s.d(S,{AttendanceComponent:()=>O});var l=s(177),i=s(7109),g=s(9417),p=s(353),u=s(4774),_=s(9079),h=s(980),r=s(3887),t=s(7705),v=s(765),f=s(6505);function C(a,m){if(1&a&&t.nrm(0,"app-loader",2),2&a){const e=t.XpG();t.Y8G("isVisible",e.loading)}}function E(a,m){if(1&a&&(t.qex(0),t.j41(1,"li",12)(2,"p",13),t.EFF(3,"Date: "),t.j41(4,"span",14),t.EFF(5),t.k0s()(),t.j41(6,"p",15),t.EFF(7,"Sign In: "),t.j41(8,"span",14),t.EFF(9),t.k0s()(),t.j41(10,"p",15),t.EFF(11,"Sign Out: "),t.j41(12,"span",14),t.EFF(13),t.k0s()(),t.j41(14,"p",16)(15,"span",14),t.EFF(16),t.k0s()()(),t.bVm()),2&a){const e=m.$implicit,n=t.XpG(3);t.R7$(5),t.JRh(null==e?null:e.parsed_attendance_date),t.R7$(4),t.JRh(n.convertToBangladeshTime(null==e?null:e.sign_in_time_bd)),t.R7$(4),t.JRh(n.convertToBangladeshTime(null==e?null:e.sign_out_time_bd)),t.R7$(1),t.Y8G("ngClass",n.getTotalTimeClass(e)),t.R7$(2),t.JRh(n.getTotalTime(e))}}function x(a,m){if(1&a&&(t.j41(0,"ul",10),t.DNE(1,E,17,5,"ng-container",11),t.k0s()),2&a){const e=t.XpG(2);t.R7$(1),t.Y8G("ngForOf",e.data)}}function A(a,m){1&a&&(t.j41(0,"div",17),t.nrm(1,"img",18),t.j41(2,"h2",19),t.EFF(3,"No Data Found"),t.k0s(),t.j41(4,"p",20),t.EFF(5,"Try refining your search or adding new data."),t.k0s()())}function F(a,m){if(1&a&&t.EFF(0),2&a){const e=m.range;t.E5c(" ",e[0]," - ",e[1]," of ",m.$implicit," items ")}}function I(a,m){if(1&a){const e=t.RV6();t.j41(0,"div",3),t.DNE(1,x,2,1,"ul",4),t.DNE(2,A,6,0,"div",5),t.j41(3,"div",6)(4,"div",7)(5,"nz-pagination",8),t.bIt("nzPageIndexChange",function(o){t.eBV(e);const c=t.XpG();return t.Njj(c.currentIndex=o)})("nzPageSizeChange",function(o){t.eBV(e);const c=t.XpG();return t.Njj(c.pageSize=o)})("nzPageIndexChange",function(o){t.eBV(e);const c=t.XpG();return t.Njj(c.onPageIndexChange(o))})("nzPageSizeChange",function(o){t.eBV(e);const c=t.XpG();return t.Njj(c.onPageSizeChange(o))}),t.k0s(),t.DNE(6,F,1,3,"ng-template",null,9,t.C5r),t.k0s()()()}if(2&a){const e=t.sdS(7),n=t.XpG();t.R7$(1),t.Y8G("ngIf",n.data.length),t.R7$(1),t.Y8G("ngIf",!n.data.length),t.R7$(3),t.Y8G("nzPageIndex",n.currentIndex)("nzPageSize",n.pageSize)("nzShowSizeChanger",!0)("nzShowTotal",e)("nzTotal",n.totalCount)}}let w=(()=>{class a{constructor(){this.data=[],this.actionEmitter=new t.bkB,this.paginationEvent=new t.bkB,this.loading=!1,this.totalCount=0,this.currentIndex=1,this.offset=0,this.pageSize=r.YM.PAGE_SIZE}onPageIndexChange(e){this.currentIndex=e,this.offset=(e-1)*this.pageSize,this.paginationEvent.emit({offset:this.offset,limit:this.pageSize})}onPageSizeChange(e){this.pageSize=e,this.currentIndex=1,this.offset=0,this.paginationEvent.emit({offset:this.offset,limit:this.pageSize})}handleAddCategory(){this.actionEmitter.emit({action:"create",value:null})}handleAction(e,n){this.actionEmitter.emit({action:e,value:n})}convertToBangladeshTime(e){if(e){const n=new Date(e);return new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"numeric",hour12:!0,timeZone:"Asia/Dhaka"}).format(n)}return null}getTotalTime(e){if(!e?.attendance_date)return"Invalid data.";const n=new Date,o=new Date(e.attendance_date),c=o.getFullYear()===n.getFullYear()&&o.getMonth()===n.getMonth()&&o.getDate()===n.getDate(),d=e?.sign_in_time_bd?new Date(e.sign_in_time_bd):null,T=e?.sign_out_time_bd?new Date(e.sign_out_time_bd):null;if(!d)return c?"Not signed in yet.":"Absent";if(d&&!T)return c?"Currently signed in.":"Missed signing out.";if(d&&T){const b=T.getTime()-d.getTime();return b<=0?"Invalid time range.":`Total Time: ${Math.floor(b/36e5)}h ${Math.floor(b%36e5/6e4)}m`}return"Invalid data."}getTotalTimeClass(e){switch(this.getTotalTime(e)){case"Absent":case"Missed signing out.":return"text-red-500";case"Not signed in yet.":return"text-yellow-500";case"Currently signed in.":return"text-green-500";default:return"text-gray-500"}}static{this.\u0275fac=function(n){return new(n||a)}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-view-self-attendance-list"]],inputs:{data:"data",loading:"loading",totalCount:"totalCount"},outputs:{actionEmitter:"actionEmitter",paginationEvent:"paginationEvent"},standalone:!0,features:[t.aNF],decls:2,vars:2,consts:[[3,"isVisible",4,"ngIf"],["class","p-4 border rounded-md",4,"ngIf"],[3,"isVisible"],[1,"p-4","border","rounded-md"],["class","divide-y divide-gray-100",4,"ngIf"],["class","flex flex-col items-center justify-center h-full text-center bg-gray-50 p-8 rounded-md space-y-4",4,"ngIf"],[1,"bg-white","grid","grid-cols-1","h-16"],[1,"flex","items-center","justify-end","mr-6"],[3,"nzPageIndex","nzPageSize","nzShowSizeChanger","nzShowTotal","nzTotal","nzPageIndexChange","nzPageSizeChange"],["rangeTemplate",""],[1,"divide-y","divide-gray-100"],[4,"ngFor","ngForOf"],[1,"grid","md:grid-cols-4","gap-x-6","py-5"],[1,"text-sm/6","text-[#180B26]","font-semibold"],[1,"font-normal"],[1,"mt-1","text-xs/5","text-gray-500","font-semibold"],[1,"mt-1","text-xs/5","font-semibold",3,"ngClass"],[1,"flex","flex-col","items-center","justify-center","h-full","text-center","bg-gray-50","p-8","rounded-md","space-y-4"],["src","assets/icons/no_data.svg","alt","No Data Found"],[1,"text-lg","font-semibold","text-black"],[1,"text-black"]],template:function(n,o){1&n&&(t.DNE(0,C,1,1,"app-loader",0),t.DNE(1,I,8,7,"div",1)),2&n&&(t.Y8G("ngIf",o.loading),t.R7$(1),t.Y8G("ngIf",!o.loading))},dependencies:[l.MD,l.YU,l.Sq,l.bT,i.Z,f.ae,v.V]})}}return a})();var D=s(6504),j=s(5816),z=s(8960);function P(a,m){if(1&a&&t.nrm(0,"app-loader",15),2&a){const e=t.XpG();t.Y8G("isVisible",e.loading)}}function R(a,m){if(1&a){const e=t.RV6();t.j41(0,"primary-button",19),t.bIt("click",function(){t.eBV(e);const o=t.XpG(2);return t.Njj(o.handleSignInAndOut())}),t.k0s()}if(2&a){const e=t.XpG(2);t.Y8G("loading",e.loading)("label",e.isSignedIn?"Sign Out":"Sign In")}}function G(a,m){if(1&a&&(t.j41(0,"div",2)(1,"p",5),t.EFF(2,"Current Status: "),t.j41(3,"span",16),t.EFF(4),t.k0s()(),t.j41(5,"p",5),t.EFF(6),t.k0s(),t.j41(7,"div",17),t.DNE(8,R,1,2,"primary-button",18),t.k0s()()),2&a){const e=t.XpG();t.R7$(4),t.JRh(e.getAttendanceStatusText()),t.R7$(2),t.JRh(e.getAttendanceTimeText()),t.R7$(2),t.Y8G("ngIf",!e.isSignedOut)}}let O=(()=>{class a{constructor(e,n,o){this._notificationService=e,this._httpService=n,this._destroyRef=o,this.isSignedIn=!1,this.isSignedOut=!1,this.data=[],this.totalCount=0,this.listLoading=!1,this.loading=!1,this.payload={offset:0,limit:r.YM.PAGE_SIZE,month:""},this.isFilter=!1,this.dateControl=new g.MJ(""),this.currentAttendanceStatus=null}ngOnInit(){this.checkCurrentAttendanceStatus(),this.setCurrentMonth(),this.loadList(),this.dateControl.valueChanges.subscribe(e=>{this.onDateChange(e)})}setCurrentMonth(){const e=new Date;this.payload.month=e.toISOString().slice(0,7),this.dateControl.setValue(e.toISOString().slice(0,7))}getFormattedDate(){return(new Date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}getFormattedTime(){return(new Date).toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric",hour12:!0})}getButtonLabel(){return this.isSignedIn?"Sign Out":"Sign In"}handleSignInAndOut(){this.loading=!0;const e={oid:this.currentAttendanceStatus?.oid??null,attendance_date:new Date,attendance_time:new Date,attendance_location:null,action:this.isSignedIn?"Sign Out":"Sign In"};navigator.geolocation?navigator.geolocation.getCurrentPosition(n=>{this.getStreetName(n.coords.latitude,n.coords.longitude,e)},n=>{this.loading=!1,console.error("Geolocation error:",n),this._notificationService.error("Error","Failed to get location! Try again!")}):(this.loading=!1,this._notificationService.warning("Warning!!","Location is required for attendance. Please enable the permission for location in your browser."))}sendPayload(e){this.loading=!0,this._httpService.post(u.A.UPDATE_ATTENDANCE,e).pipe((0,_.pQ)(this._destroyRef),(0,h.j)(()=>this.loading=!1)).subscribe({next:n=>{this._notificationService.success("Success!",n?.body?.message),200===n.body.code&&(this.checkCurrentAttendanceStatus(),this.loadList())},error:n=>{console.log(n),this._notificationService.error("Error!",n?.error?.message)}})}getStreetName(e,n,o){fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${n}`).then(d=>d.json()).then(d=>{this.loading=!1,d.address?(o.attendance_location=d.display_name,this.sendPayload(o)):(console.log("Unable to fetch address."),this._notificationService.error("Error","Failed to get location! Try again!"))}).catch(d=>{this.loading=!1,console.error("Geocoding Error:",d),this._notificationService.error("Error","Failed to get location! Try again!")})}handleListActions(e){console.log(e)}onDateChange(e){if(e){const n=new Date(e);this.payload.month=n.toISOString().slice(0,7),this.isFilter=!0,this.loadList()}else this._notificationService.warning("Warning!","Please Select A Month!")}handlePaginationEvent(e){this.payload={...this.payload,offset:e.offset,limit:e.limit},this.loadList()}loadList(){this.isFilter||(this.listLoading=!0),this._httpService.get(u.A.GET_ATTENDANCE_LIST,this.payload).pipe((0,_.pQ)(this._destroyRef),(0,h.j)(()=>this.listLoading=!1)).subscribe({next:e=>{200===e.status&&(this.data=[],e.body?.data?.length?(this.data=e.body.data,this.totalCount=e.body.total):this.data=[])},error:e=>{console.log(e),this._notificationService.error("Error!",e?.error?.message)}})}checkCurrentAttendanceStatus(){this.loading=!0,this._httpService.get(u.A.CHECK_CURRENT_ATTENDANCE_STATUS).pipe((0,_.pQ)(this._destroyRef),(0,h.j)(()=>this.loading=!1)).subscribe({next:e=>{200===e.status?(this.currentAttendanceStatus=e.body.data||null,this.isSignedIn=!(!this.currentAttendanceStatus?.sign_in_time||this.currentAttendanceStatus?.sign_out_time),this.isSignedOut=!(!this.currentAttendanceStatus?.sign_in_time||!this.currentAttendanceStatus?.sign_out_time)):this.resetAttendanceStatus()},error:e=>{console.log(e),this._notificationService.error("Error!",e?.error?.message)}})}resetAttendanceStatus(){this.currentAttendanceStatus=null,this.isSignedIn=!1,this.isSignedOut=!1}getAttendanceStatusText(){return this.currentAttendanceStatus?this.currentAttendanceStatus.sign_in_time&&!this.currentAttendanceStatus.sign_out_time?"Signed In":this.currentAttendanceStatus.sign_in_time&&this.currentAttendanceStatus.sign_out_time?"Signed Out":"Not Signed In":"Not Signed In"}getAttendanceTimeText(){return this.currentAttendanceStatus?this.currentAttendanceStatus.sign_in_time&&!this.currentAttendanceStatus.sign_out_time?`Sign In Time: ${this.formatTime(this.currentAttendanceStatus.sign_in_time)}`:this.currentAttendanceStatus.sign_in_time&&this.currentAttendanceStatus.sign_out_time?`Sign Out Time: ${this.formatTime(this.currentAttendanceStatus.sign_out_time)}`:null:null}formatTime(e){const n=new Date(e);return new Date(n.toLocaleString("en-US",{timeZone:"Asia/Dhaka"})).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}static{this.\u0275fac=function(n){return new(n||a)(t.rXU(D.xY),t.rXU(j.k),t.rXU(t.abz))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-attendance"]],standalone:!0,features:[t.aNF],decls:21,vars:8,consts:[[1,"p-4","space-y-3"],[1,"p-4","text-secondary","bg-[#F9FAFB]","border-[1px]","rounded-md","border-[#E5E7EB]","shadow-sm","flex","justify-between"],[1,"space-y-4"],[1,"text-lg","font-semibold"],[1,"space-y-1"],[1,"text-gray-500"],[1,"text-2xl"],[1,"flex","justify-center","items-center"],[3,"isVisible",4,"ngIf"],["class","space-y-4",4,"ngIf"],[1,"p-4","border-[1px]","rounded-md","border-[#E5E7EB]","shadow-sm"],[1,"md:flex","justify-between","items-center","mb-4"],[1,"text-2xl","font-medium","mb-4"],["nzInputReadOnly","","nzMode","month",3,"formControl"],[3,"loading","data","totalCount","actionEmitter","paginationEvent"],[3,"isVisible"],[1,"text-secondary"],[1,"flex","justify-end","gap-4"],["type","button",3,"loading","label","click",4,"ngIf"],["type","button",3,"loading","label","click"]],template:function(n,o){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),t.EFF(4,"Today's Attendance"),t.k0s(),t.j41(5,"div",4)(6,"p",5),t.EFF(7,"Current Time"),t.k0s(),t.j41(8,"p",6),t.EFF(9),t.k0s(),t.j41(10,"p",5),t.EFF(11),t.k0s()()(),t.j41(12,"div",7),t.DNE(13,P,1,1,"app-loader",8),t.DNE(14,G,9,3,"div",9),t.k0s()(),t.j41(15,"div",10)(16,"div",11)(17,"h2",12),t.EFF(18,"Attendance Record"),t.k0s(),t.nrm(19,"nz-date-picker",13),t.k0s(),t.j41(20,"app-view-self-attendance-list",14),t.bIt("actionEmitter",function(d){return o.handleListActions(d)})("paginationEvent",function(d){return o.handlePaginationEvent(d)}),t.k0s()()()),2&n&&(t.R7$(9),t.JRh(o.getFormattedTime()),t.R7$(2),t.JRh(o.getFormattedDate()),t.R7$(2),t.Y8G("ngIf",o.loading),t.R7$(1),t.Y8G("ngIf",!o.loading),t.R7$(5),t.Y8G("formControl",o.dateControl),t.R7$(1),t.Y8G("loading",o.listLoading)("data",o.data)("totalCount",o.totalCount))},dependencies:[l.MD,l.bT,i.Z,z.SN,g.YN,g.BC,p.j,g.X1,g.l_,w,v.V]})}}return a})()},353:(y,S,s)=>{s.d(S,{j:()=>h});var l=s(177),i=s(7705);let g=(()=>{class r{static{this.\u0275fac=function(f){return new(f||r)}}static{this.\u0275cmp=i.VBU({type:r,selectors:[["app-spinner"]],standalone:!0,features:[i.aNF],decls:3,vars:0,consts:[["fill","none","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"-ml-1","mr-3","h-5","w-5","animate-spin","text-white"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z","fill","currentColor",1,"opacity-75"]],template:function(f,C){1&f&&(i.qSk(),i.j41(0,"svg",0),i.nrm(1,"circle",1)(2,"path",2),i.k0s())},dependencies:[l.MD]})}}return r})();var p=s(7002);function u(r,t){1&r&&(i.j41(0,"span"),i.nrm(1,"app-spinner"),i.k0s())}function _(r,t){if(1&r&&(i.j41(0,"span",4),i.EFF(1),i.k0s()),2&r){const v=i.XpG();i.R7$(1),i.SpI(" ",v.label," ")}}let h=(()=>{class r{constructor(){this.type="button",this.loading=!1}static{this.\u0275fac=function(f){return new(f||r)}}static{this.\u0275cmp=i.VBU({type:r,selectors:[["primary-button"]],inputs:{label:"label",type:"type",loading:"loading"},standalone:!0,features:[i.aNF],decls:4,vars:5,consts:[["disableForGuest","",1,"min-w-min","group","relative","flex","items-center","gap-4","overflow-hidden","rounded-sm","bg-white","px-6","py-2","shadow","font-medium","disabled:cursor-not-allowed",3,"disabled","type"],[1,"absolute","inset-0","w-2","bg-primary","transition-all","duration-300","ease-in-out","group-hover:w-full",3,"ngClass"],[4,"ngIf"],["class","relative z-10 whitespace-nowrap text-black transition-all duration-300 group-hover:text-white",4,"ngIf"],[1,"relative","z-10","whitespace-nowrap","text-black","transition-all","duration-300","group-hover:text-white"]],template:function(f,C){1&f&&(i.j41(0,"button",0),i.nrm(1,"div",1),i.DNE(2,u,2,0,"span",2),i.DNE(3,_,2,1,"span",3),i.k0s()),2&f&&(i.Y8G("disabled",C.loading)("type",C.type),i.R7$(1),i.Y8G("ngClass",C.loading?"w-full":""),i.R7$(1),i.Y8G("ngIf",C.loading),i.R7$(1),i.Y8G("ngIf",!C.loading))},dependencies:[l.MD,l.YU,l.bT,g,p.x]})}}return r})()},765:(y,S,s)=>{s.d(S,{V:()=>p});var l=s(177),i=s(7705);function g(u,_){1&u&&(i.j41(0,"div",1),i.nrm(1,"span")(2,"span")(3,"span")(4,"span")(5,"span"),i.k0s())}let p=(()=>{class u{constructor(){this.isVisible=!1,this.showLoader=!1}ngOnInit(){this.isVisible&&(this.showLoader=!0,setTimeout(()=>{this.showLoader=!1},500))}static{this.\u0275fac=function(r){return new(r||u)}}static{this.\u0275cmp=i.VBU({type:u,selectors:[["app-loader"]],inputs:{isVisible:"isVisible"},standalone:!0,features:[i.aNF],decls:1,vars:1,consts:[["class","loading",4,"ngIf"],[1,"loading"]],template:function(r,t){1&r&&i.DNE(0,g,6,0,"div",0),2&r&&i.Y8G("ngIf",t.isVisible)},dependencies:[l.MD,l.bT],styles:[".loading[_ngcontent-%COMP%]{--speed-of-animation: .9s;--gap: 6px;--first-color: #4c86f9;--second-color: #49a84c;--third-color: #f6bb02;--fourth-color: #f6bb02;--fifth-color: #2196f3;display:flex;justify-content:center;align-items:center;gap:6px}.loading[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:4px;height:50px;background:var(--first-color);animation:_ngcontent-%COMP%_scale var(--speed-of-animation) ease-in-out infinite}.loading[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){background:var(--second-color);animation-delay:-.8s}.loading[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(3){background:var(--third-color);animation-delay:-.7s}.loading[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(4){background:var(--fourth-color);animation-delay:-.6s}.loading[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(5){background:var(--fifth-color);animation-delay:-.5s}@keyframes _ngcontent-%COMP%_scale{0%,40%,to{transform:scaleY(.05)}20%{transform:scaleY(1)}}"]})}}return u})()},7002:(y,S,s)=>{s.d(S,{x:()=>g});var l=s(7705),i=s(3769);let g=(()=>{class p{constructor(_,h,r){this.el=_,this.renderer=h,this.authService=r}ngOnInit(){this.authService.getGuestUserStatus()&&this.renderer.setAttribute(this.el.nativeElement,"disabled","true")}static{this.\u0275fac=function(h){return new(h||p)(l.rXU(l.aKT),l.rXU(l.sFG),l.rXU(i.u))}}static{this.\u0275dir=l.FsC({type:p,selectors:[["","disableForGuest",""]],standalone:!0})}}return p})()}}]);