"use strict";(self.webpackChunkims=self.webpackChunkims||[]).push([[6448],{2530:(D,h,e)=>{e.d(h,{E:()=>z});var t=e(5312),m=e(9437),a=e(7673),p=e(7705),E=e(1626);let z=(()=>{class _{constructor(d){this.http=d,this.uploadUrl=`https://api.cloudinary.com/v1_1/${t.c.cloudinary.cloudName}/image/upload`}uploadImage(d){const s=new FormData;return s.append("file",d),s.append("upload_preset",t.c.cloudinary.uploadPreset),s.append("cloud_name",t.c.cloudinary.cloudName),s.append("folder","ims"),this.http.post(this.uploadUrl,s).pipe((0,m.W)(f=>(console.error("Upload failed",f),(0,a.of)({error:"Upload failed, please try again later."}))))}static{this.\u0275fac=function(s){return new(s||_)(p.KVO(E.Qq))}}static{this.\u0275prov=p.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}}return _})()},6448:(D,h,e)=>{e.d(h,{F:()=>$});var t=e(7705),m=e(177),a=e(9417),p=e(3040),E=e(4177),z=e(353),_=e(9475),b=e(7109),d=e(9079),s=e(4774),f=e(980),P=e(4958),O=e(3371),T=e(765),L=e(7002),M=e(6475),F=e(5816),I=e(6504),U=e(2530),R=e(7529),g=e(8927),C=e(1011),y=e(1997);function j(r,l){1&r&&(t.qSk(),t.j41(0,"svg",40),t.nrm(1,"path",41),t.k0s())}function k(r,l){if(1&r&&t.nrm(0,"app-loader",42),2&r){const o=t.XpG(2);t.Y8G("isVisible",o.imgLoading)}}function A(r,l){if(1&r){const o=t.RV6();t.j41(0,"div",37),t.bIt("click",function(){t.eBV(o),t.XpG();const n=t.sdS(8);return t.Njj(n.click())}),t.DNE(1,j,2,0,"svg",38),t.DNE(2,k,1,1,"app-loader",39),t.k0s()}if(2&r){const o=t.XpG();t.R7$(1),t.Y8G("ngIf",!o.imgLoading),t.R7$(1),t.Y8G("ngIf",o.imgLoading)}}function G(r,l){1&r&&(t.j41(0,"p",43),t.EFF(1," Upload a file "),t.k0s())}function B(r,l){1&r&&(t.j41(0,"p",44),t.EFF(1," PNG, JPG, JPEG up to 500KB "),t.k0s())}function x(r,l){if(1&r){const o=t.RV6();t.j41(0,"div",45)(1,"div",46),t.nrm(2,"img",47),t.k0s(),t.j41(3,"div",48)(4,"danger-button",49),t.bIt("click",function(){t.eBV(o);const n=t.XpG();return t.Njj(n.removePhoto())}),t.k0s()()()}if(2&r){const o=t.XpG();t.R7$(2),t.Y8G("src",o.form.controls.photo.value,t.B4B),t.R7$(2),t.Y8G("label","Retake Photo")("type","button")}}function S(r,l){if(1&r&&(t.qex(0),t.nrm(1,"nz-option",50),t.bVm()),2&r){const o=l.$implicit;t.R7$(1),t.Y8G("nzLabel",o.label)("nzValue",o.value)}}function N(r,l){if(1&r&&(t.qex(0),t.nrm(1,"nz-option",50),t.bVm()),2&r){const o=l.$implicit;t.R7$(1),t.Y8G("nzLabel",o.label)("nzValue",o.value)}}function V(r,l){if(1&r&&(t.qex(0),t.nrm(1,"nz-option",50),t.bVm()),2&r){const o=l.$implicit;t.R7$(1),t.Y8G("nzLabel",o.label)("nzValue",o.value)}}function K(r,l){if(1&r&&(t.qex(0),t.nrm(1,"nz-option",50),t.bVm()),2&r){const o=l.$implicit;t.R7$(1),t.Y8G("nzLabel",o.label)("nzValue",o.value)}}let $=(()=>{class r{constructor(o,i,n,u,c,v){this._fb=o,this._modal=i,this._httpService=n,this._destroyRef=u,this._notificationService=c,this._fileService=v,this.actionEmitter=new t.bkB,this.loading=!1,this.imgLoading=!1,this.categoryList=[],this.subCategoryList=[],this.productNatureList=[],this.unitTypes=[]}ngOnInit(){this.form=this.createForm(),this.formData&&this.form.patchValue(this.formData),this.loadCategoryList(),this.productNatureList=P.V.PRODUCT_NATURE,this.unitTypes=P.V.MEASUREMENT_UNITS,this.form.controls.category_oid.valueChanges.subscribe(o=>{o&&(this.loadSubCategoryList(o),this.form.controls.sub_category_oid.setValue(null))})}createForm(){return this._fb.group({oid:[null],name:[null,[a.k0.required]],sku:[null],category_oid:[null,[a.k0.required]],sub_category_oid:[null,[a.k0.required]],unit_type:[null],description:[null],photo:[null],product_nature:[null,[a.k0.required]],restock_threshold:[null,[a.k0.required]],status:["Active",[a.k0.required]]})}handleConfirm(){let o="Do you want to create a product?";this.formData&&(o="Are you sure you want to save these updates?"),this._modal.create({nzContent:E.M,nzData:{message:o},nzFooter:null,nzClosable:!1,nzOnOk:()=>this.actionEmitter.emit({action:"submit",value:this.form.value})})}handleForm(){this.form.valid?this.handleConfirm():(0,p.N4)(this.form)}goBack(){this.actionEmitter.emit({action:"back",value:this.form.value})}hasRequiredValidator(o){const i=this.form.get(o);return!!i&&(0,p.op)(i)}loadCategoryList(){this._httpService.get(s.A.GET_CATEGORY_LIST_FOR_DROPDOWN).pipe((0,d.pQ)(this._destroyRef),(0,f.j)(()=>this.loading=!1)).subscribe({next:o=>{200===o.status&&(this.categoryList=[],this.categoryList=o.body?.data?.length?o.body.data:[])},error:o=>{console.log(o)}})}loadSubCategoryList(o){this._httpService.get(s.A.GET_SUB_CATEGORY_LIST_FOR_DROPDOWN,{category_oid:o}).pipe((0,d.pQ)(this._destroyRef),(0,f.j)(()=>this.loading=!1)).subscribe({next:i=>{200===i.status&&(this.subCategoryList=[],this.subCategoryList=i.body?.data?.length?i.body.data:[])},error:i=>{console.log(i)}})}onFileSelected(o){const i=o.target;if(i.files&&i.files[0]){const n=i.files[0];if(n.size>512e3)return void this._notificationService.error("Error","File size exceeds 500 KB. Please upload a smaller file.");this.imgLoading=!0,this._fileService.uploadImage(n).subscribe({next:c=>{this.form.controls.photo.setValue(c.secure_url),this.imgLoading=!1},error:c=>{this._notificationService.error("Error","Failed to upload image"),console.error("Image upload error:",c),this.imgLoading=!1}})}}removePhoto(){this.form.controls.photo.setValue(null);const o=document.querySelector('input[type="file"]');o&&(o.value="")}static{this.\u0275fac=function(i){return new(i||r)(t.rXU(a.ok),t.rXU(M.N_),t.rXU(F.k),t.rXU(t.abz),t.rXU(I.xY),t.rXU(U.E))}}static{this.\u0275cmp=t.VBU({type:r,selectors:[["app-product-form"]],inputs:{formData:"formData",loading:"loading"},outputs:{actionEmitter:"actionEmitter"},standalone:!0,features:[t.aNF],decls:66,vars:23,consts:[[1,"rounded-md","bg-white"],["nz-form","",3,"formGroup","nzLayout","ngSubmit"],[1,"grid","grid-cols-1","gap-y-6","lg:gap-6","md:grid-cols-2","lg:grid-cols-3","border-[0.5px]","p-4","rounded-md"],[1,"p-4","border-[0.5px]","rounded-md","shadow-md","md:col-span-2","lg:col-span-1","flex","flex-col","items-center","justify-center"],["class","flex flex-col items-center justify-center w-3/4 h-full border-[0.5px] border-dashed rounded-md shadow-md cursor-pointer",3,"click",4,"ngIf"],["class","text-center text-blue-500 font-medium mt-4",4,"ngIf"],["class","text-xs text-gray-500",4,"ngIf"],["disableForGuest","","type","file","accept",".png,.jpg,.jpeg,.gif",1,"hidden",3,"change"],["fileInput",""],["class","w-full flex flex-col items-center h-full gap-4",4,"ngIf"],[1,"grid","grid-cols-1","gap-x-6","md:grid-cols-2","border-[0.5px]","p-4","rounded-md","col-span-2"],[3,"nzRequired"],["nzErrorTip","Product Name is Required."],["formControlName","name","nz-input","","placeholder","Enter Product Name"],["nzErrorTip","Product Nature is required."],["formControlName","product_nature","nz-input","","nzAllowClear","","nzPlaceHolder","Select Product Nature",1,"w-full"],[4,"ngFor","ngForOf"],["nzErrorTip","Category is required."],["formControlName","category_oid","nz-input","","nzAllowClear","","nzPlaceHolder","Select Category",1,"w-full"],["nzErrorTip","Sub Category is required."],["formControlName","sub_category_oid","nz-input","","nzAllowClear","","nzPlaceHolder","Select Sub Category",1,"w-full"],["nzErrorTip","Restock Threshold is Required."],["formControlName","restock_threshold","nz-input","","placeholder","Enter Restock Threshold"],["nzErrorTip","Unit Type is required."],["formControlName","unit_type","nz-input","","nzAllowClear","","nzPlaceHolder","Select Unit Type",1,"w-full"],["nzErrorTip","SKU is Required."],["formControlName","sku","nz-input","","placeholder","Enter SKU"],["nzErrorTip","Description is Required."],["formControlName","description","nz-input","","placeholder","Enter Description","nzAutosize",""],["nzErrorTip","Status is required."],["formControlName","status","nz-input","","nzAllowClear","","nzPlaceHolder","Select Status",1,"w-full"],["nzLabel","Active","nzValue","Active"],["nzLabel","Inactive","nzValue","Inactive"],[1,"flex","justify-end","mt-4"],[1,"flex","items-center","gap-4"],[3,"label","click"],[3,"label","loading","type"],[1,"flex","flex-col","items-center","justify-center","w-3/4","h-full","border-[0.5px]","border-dashed","rounded-md","shadow-md","cursor-pointer",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor","class","size-6",4,"ngIf"],[3,"isVisible",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-6"],["stroke-linecap","round","stroke-linejoin","round","d","M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"],[3,"isVisible"],[1,"text-center","text-blue-500","font-medium","mt-4"],[1,"text-xs","text-gray-500"],[1,"w-full","flex","flex-col","items-center","h-full","gap-4"],[1,"flex-1","flex","items-center","justify-center","w-full"],["alt","Product Photo",1,"w-3/4","max-h-full","border-[0.5px]","border-dashed","rounded-md","shadow-md","object-contain",3,"src"],[1,"mt-auto","w-full","flex","justify-center"],[3,"label","type","click"],[3,"nzLabel","nzValue"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"form",1),t.bIt("ngSubmit",function(){return n.handleForm()}),t.j41(2,"div",2)(3,"div",3),t.DNE(4,A,3,2,"div",4),t.DNE(5,G,2,0,"p",5),t.DNE(6,B,2,0,"p",6),t.j41(7,"input",7,8),t.bIt("change",function(c){return n.onFileSelected(c)}),t.k0s(),t.DNE(9,x,5,3,"div",9),t.k0s(),t.j41(10,"div",10)(11,"nz-form-item")(12,"nz-form-label",11),t.EFF(13,"Product Name"),t.k0s(),t.j41(14,"nz-form-control",12),t.nrm(15,"input",13),t.k0s()(),t.j41(16,"nz-form-item")(17,"nz-form-label",11),t.EFF(18,"Product Nature"),t.k0s(),t.j41(19,"nz-form-control",14)(20,"nz-select",15),t.DNE(21,S,2,2,"ng-container",16),t.k0s()()(),t.j41(22,"nz-form-item")(23,"nz-form-label",11),t.EFF(24,"Category"),t.k0s(),t.j41(25,"nz-form-control",17)(26,"nz-select",18),t.DNE(27,N,2,2,"ng-container",16),t.k0s()()(),t.j41(28,"nz-form-item")(29,"nz-form-label",11),t.EFF(30,"Sub Category"),t.k0s(),t.j41(31,"nz-form-control",19)(32,"nz-select",20),t.DNE(33,V,2,2,"ng-container",16),t.k0s()()(),t.j41(34,"nz-form-item")(35,"nz-form-label",11),t.EFF(36,"Restock Threshold"),t.k0s(),t.j41(37,"nz-form-control",21),t.nrm(38,"input",22),t.k0s()(),t.j41(39,"nz-form-item")(40,"nz-form-label",11),t.EFF(41,"Unit Type"),t.k0s(),t.j41(42,"nz-form-control",23)(43,"nz-select",24),t.DNE(44,K,2,2,"ng-container",16),t.k0s()()(),t.j41(45,"nz-form-item")(46,"nz-form-label",11),t.EFF(47,"SKU"),t.k0s(),t.j41(48,"nz-form-control",25),t.nrm(49,"input",26),t.k0s()(),t.j41(50,"nz-form-item")(51,"nz-form-label",11),t.EFF(52,"Description"),t.k0s(),t.j41(53,"nz-form-control",27),t.nrm(54,"textarea",28),t.k0s()(),t.j41(55,"nz-form-item")(56,"nz-form-label",11),t.EFF(57,"Status"),t.k0s(),t.j41(58,"nz-form-control",29)(59,"nz-select",30),t.nrm(60,"nz-option",31)(61,"nz-option",32),t.k0s()()()()(),t.j41(62,"div",33)(63,"div",34)(64,"secondary-button",35),t.bIt("click",function(){return n.goBack()}),t.k0s(),t.nrm(65,"primary-button",36),t.k0s()()()()),2&i&&(t.R7$(1),t.Y8G("formGroup",n.form)("nzLayout","vertical"),t.R7$(3),t.Y8G("ngIf",!n.form.controls.photo.value),t.R7$(1),t.Y8G("ngIf",!n.form.controls.photo.value),t.R7$(1),t.Y8G("ngIf",!n.form.controls.photo.value),t.R7$(3),t.Y8G("ngIf",n.form.controls.photo.value),t.R7$(3),t.Y8G("nzRequired",n.hasRequiredValidator("name")),t.R7$(5),t.Y8G("nzRequired",n.hasRequiredValidator("product_nature")),t.R7$(4),t.Y8G("ngForOf",n.productNatureList),t.R7$(2),t.Y8G("nzRequired",n.hasRequiredValidator("category_oid")),t.R7$(4),t.Y8G("ngForOf",n.categoryList),t.R7$(2),t.Y8G("nzRequired",n.hasRequiredValidator("category_oid")),t.R7$(4),t.Y8G("ngForOf",n.subCategoryList),t.R7$(2),t.Y8G("nzRequired",n.hasRequiredValidator("restock_threshold")),t.R7$(5),t.Y8G("nzRequired",n.hasRequiredValidator("unit_type")),t.R7$(4),t.Y8G("ngForOf",n.unitTypes),t.R7$(2),t.Y8G("nzRequired",n.hasRequiredValidator("sku")),t.R7$(5),t.Y8G("nzRequired",n.hasRequiredValidator("description")),t.R7$(5),t.Y8G("nzRequired",n.hasRequiredValidator("status")),t.R7$(8),t.Y8G("label","Cancel"),t.R7$(1),t.Y8G("label","Submit")("loading",n.loading)("type","submit"))},dependencies:[m.MD,m.Sq,m.bT,b.Z,R.Uq,R.e,g.CA,g.Ls,g.Mo,g.zS,C.Sy,C.c9,y.ld,y.WI,a.X1,a.qT,a.me,a.BC,a.cb,a.j4,a.JD,z.j,_.t,O.Q,T.V,L.x],styles:["input[type=file][_ngcontent-%COMP%]{display:none}"]})}}return r})()}}]);