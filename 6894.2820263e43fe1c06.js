"use strict";(self.webpackChunkims=self.webpackChunkims||[]).push([[6894],{3040:(R,v,r)=>{r.d(v,{N4:()=>a,op:()=>i});var u=r(9417);function a(s){Object.values(s.controls).forEach(l=>{l.invalid&&(l.markAsDirty(),l.updateValueAndValidity({onlySelf:!0})),l instanceof u.gE&&Object.values(l.controls).forEach(p=>{p.invalid&&(p.markAsDirty(),p.updateValueAndValidity({onlySelf:!0}))}),l instanceof u.Yp&&Object.values(l.controls).forEach(p=>{p instanceof u.gE&&Object.values(p.controls).forEach(_=>{_.invalid&&(_.markAsDirty(),_.updateValueAndValidity({onlySelf:!0}))})})})}function i(s){if(s.validator){const l=s.validator({});return l&&l.required}return!1}},6894:(R,v,r)=>{r.r(v),r.d(v,{QuickSaleComponent:()=>at});var u=r(177),a=r(7109),i=r(9417),f=r(8928),b=r(765),t=r(7705),s=r(9079),l=r(4774),p=r(1413),_=r(152),m=r(3294),h=r(980),k=r(3040),I=r(8018),j=r(5816),x=r(6504),E=r(7529),$=r(513),D=r(6389),G=r(5930),V=r(5703),z=r(8927),C=r(1011),P=r(1997),q=r(2047);function N(c,g){if(1&c&&t.nrm(0,"app-loader",2),2&c){const e=t.XpG();t.Y8G("isVisible",e.loading)}}function B(c,g){if(1&c&&t.nrm(0,"nz-option",18),2&c){const e=g.$implicit,n=t.XpG(3);t.Y8G("nzValue",e.inventory_oid)("nzLabel",n.getProductDisplayLabel(e))}}function L(c,g){if(1&c&&(t.j41(0,"nz-option-group",16),t.DNE(1,B,1,2,"nz-option",17),t.k0s()),2&c){const e=g.$implicit;t.Y8G("nzLabel",e.sub_category+" - "+e.parent_category),t.R7$(1),t.Y8G("ngForOf",e.children)}}function Y(c,g){if(1&c&&(t.j41(0,"div",19)(1,"span",20),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"button",21),t.EFF(5),t.nI1(6,"translate"),t.k0s()()),2&c){const e=t.XpG(2);t.R7$(2),t.JRh(t.bMT(3,3,"sales.quick_sale.select_product.form.card_title")),t.R7$(2),t.Y8G("disabled",e.form.invalid),t.R7$(1),t.JRh(t.bMT(6,5,"sales.quick_sale.select_product.form.add_to_invoice"))}}function A(c,g){if(1&c){const e=t.RV6();t.j41(0,"div",3)(1,"form",4),t.bIt("ngSubmit",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.addToInvoice())}),t.j41(2,"nz-form-item")(3,"nz-form-label",5),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"nz-form-control")(7,"nz-select",6),t.bIt("ngModelChange",function(o){t.eBV(e);const d=t.XpG();return t.Njj(d.onProductSelectedById(o))})("nzOnSearch",function(o){t.eBV(e);const d=t.XpG();return t.Njj(d.onChange(o))}),t.nI1(8,"translate"),t.DNE(9,L,2,2,"nz-option-group",7),t.k0s()()(),t.j41(10,"nz-card",8)(11,"div",9)(12,"nz-form-item",10)(13,"nz-form-label",11),t.EFF(14),t.nI1(15,"translate"),t.k0s(),t.j41(16,"nz-form-control"),t.nrm(17,"input",12),t.k0s()(),t.j41(18,"nz-form-item")(19,"nz-form-label",11),t.EFF(20),t.nI1(21,"translate"),t.k0s(),t.j41(22,"nz-form-control"),t.nrm(23,"input",12),t.k0s()(),t.j41(24,"nz-form-item")(25,"nz-form-label",11),t.EFF(26),t.nI1(27,"translate"),t.k0s(),t.j41(28,"nz-form-control"),t.nrm(29,"input",12),t.k0s()(),t.j41(30,"nz-form-item")(31,"nz-form-label",11),t.EFF(32),t.nI1(33,"translate"),t.k0s(),t.j41(34,"nz-form-control"),t.nrm(35,"nz-input-number",13),t.k0s()(),t.j41(36,"nz-form-item")(37,"nz-form-label",11),t.EFF(38),t.nI1(39,"translate"),t.k0s(),t.j41(40,"nz-form-control"),t.nrm(41,"nz-input-number",14),t.k0s()(),t.j41(42,"nz-form-item")(43,"nz-form-label",11),t.EFF(44),t.nI1(45,"translate"),t.k0s(),t.j41(46,"nz-form-control"),t.nrm(47,"input",12),t.nI1(48,"currency"),t.k0s()()(),t.DNE(49,Y,7,7,"ng-template",null,15,t.C5r),t.k0s()()()}if(2&c){const e=t.sdS(50),n=t.XpG();t.R7$(1),t.Y8G("formGroup",n.form)("nzLayout","vertical"),t.R7$(2),t.Y8G("nzRequired",n.hasRequiredValidator("search_input")),t.R7$(1),t.JRh(t.bMT(5,28,"sales.quick_sale.select_product.form.search_input.label")),t.R7$(3),t.Y8G("nzPlaceHolder",t.bMT(8,30,"sales.quick_sale.select_product.form.search_input.placeholder"))("nzSize","large"),t.R7$(2),t.Y8G("ngForOf",n.filteredProductList),t.R7$(1),t.Y8G("nzTitle",e),t.R7$(3),t.Y8G("nzRequired",n.hasRequiredValidator("product_oid")),t.R7$(1),t.JRh(t.bMT(15,32,"sales.quick_sale.select_product.form.product_name.label")),t.R7$(3),t.Y8G("value",n.getProductDisplayLabel(n.selectedProduct)),t.R7$(2),t.Y8G("nzRequired",n.hasRequiredValidator("unit_price")),t.R7$(1),t.JRh(t.bMT(21,34,"sales.quick_sale.select_product.form.unit_price.label")),t.R7$(3),t.Y8G("value",n.getProductUnitPriceLabel(n.selectedProduct)),t.R7$(2),t.Y8G("nzRequired",n.hasRequiredValidator("quantity_available")),t.R7$(1),t.JRh(t.bMT(27,36,"sales.quick_sale.select_product.form.quantity_available.label")),t.R7$(3),t.Y8G("value",null==n.selectedProduct?null:n.selectedProduct.quantity_available),t.R7$(2),t.Y8G("nzRequired",n.hasRequiredValidator("quantity")),t.R7$(1),t.JRh(t.bMT(33,38,"sales.quick_sale.select_product.form.quantity.label")),t.R7$(3),t.Y8G("nzMin",1)("nzMax",null==n.selectedProduct?null:n.selectedProduct.quantity),t.R7$(2),t.Y8G("nzRequired",n.hasRequiredValidator("discount")),t.R7$(1),t.JRh(t.bMT(39,40,"sales.quick_sale.select_product.form.discount.label")),t.R7$(3),t.Y8G("nzMin",0)("nzMax",null==n.selectedProduct?null:n.selectedProduct.max_discount_range),t.R7$(2),t.Y8G("nzRequired",n.hasRequiredValidator("total")),t.R7$(1),t.JRh(t.bMT(45,42,"sales.quick_sale.select_product.form.total_price.label")),t.R7$(3),t.Y8G("value",t.brH(48,44,n.getTotalPrice(),"\u09f3","symbol"))}}let U=(()=>{class c{constructor(e,n,o,d){this._fb=e,this._httpService=n,this._destroyRef=o,this._notificationService=d,this.actionEmitter=new t.bkB,this.loading=!1,this.isFilter=!1,this.productList=[],this.filteredProductList=[],this.selectedProduct=null,this.$searchSubject=new p.B}ngOnInit(){this.form=this.createForm(),this.loadProductList(),this.$searchSubject.pipe((0,_.B)(300),(0,m.F)()).subscribe(e=>{this.isFilter=!0,this.loadProductList({search_text:e})})}ngOnChanges(e){if(e.formData&&e.formData.currentValue){this.form.reset(),this.selectedProduct=null;const n=e.formData.currentValue;this.form.patchValue({inventory_oid:n.inventory_oid,product_name:n.product_name,product_oid:n.product_oid,quantity_available:n.quantity_available,quantity:n.quantity,unit_price:n.unit_price,discount:n.discount,total:n.total}),this.onProductSelectedById(n.inventory_oid)}}createForm(){return this._fb.group({search_input:[null],product_name:[null,[i.k0.required]],product_oid:[null,[i.k0.required]],inventory_oid:[null,[i.k0.required]],quantity_available:[null,[i.k0.required,i.k0.min(1)]],quantity:[1,[i.k0.required,i.k0.min(1)]],unit_price:[null,[i.k0.required,i.k0.min(0)]],discount:[0,[i.k0.required,i.k0.min(0)]],total:[0,[i.k0.required,i.k0.min(0)]]})}hasRequiredValidator(e){const n=this.form.get(e);return!!n&&(0,k.op)(n)}loadProductList(e=null){this.isFilter||(this.loading=!0),this._httpService.get(l.A.GET_PRODUCT_LIST_FOR_SALE,e).pipe((0,s.pQ)(this._destroyRef),(0,h.j)(()=>this.loading=!1)).subscribe({next:n=>{200===n.status&&(this.productList=[],n.body?.data?.length?(this.productList=n.body?.data,this.filteredProductList=this.groupProductsBySubCategory(this.productList)):(this.productList=[],this.filteredProductList=[]))},error:n=>{console.log(n),this._notificationService.error("Error!",n?.error?.message)}})}groupProductsBySubCategory(e){const n=new Map;return e.forEach(o=>{const d=o.sub_category_oid;n.has(d)||n.set(d,{sub_category:o.sub_category_name,parent_category:o.category_name,children:[]}),n.get(d).children.push({inventory_oid:o.inventory_oid,product_oid:o.product_oid,product_name:o.product_name,image_url:o.image_url,sku:o.sku,batch_code:o.batch_code,quantity_available:Number(o.quantity_available),unit_price:Number(o.selling_price),max_discount_range:Number(o.maximum_discount)})}),Array.from(n.values())}onChange(e){!e||e.length<2||this.$searchSubject.next(e)}onProductSelected(e){this.selectedProduct=e,this.form.patchValue({inventory_oid:e.inventory_oid,product_name:this.getProductDisplayLabel(e),product_oid:e.product_oid,quantity_available:e.quantity_available,quantity:this.formData?this.form.value.quantity:1,unit_price:e.unit_price,discount:this.formData?this.form.value.discount:0,total:e.unit_price})}getProductDisplayLabel(e){return e?`${e?.product_name} (${e?.batch_code})`:""}getProductUnitPriceLabel(e){return e?e?.unit_price:0}onImageError(e){e.target.src="assets/fallback.png"}addToInvoice(){this.actionEmitter.emit({action:this.formData?"update":"add",value:this.form.getRawValue()}),this.form.reset(),this.selectedProduct=null,this.formData=null}onProductSelectedById(e){for(const n of this.filteredProductList){const o=n.children.find(d=>d.inventory_oid===e);if(o){this.onProductSelected(o);break}}}getTotalPrice(){const e=Number(this.form.get("quantity")?.value)||0,n=Number(this.form.get("unit_price")?.value)||0,o=Number(this.form.get("discount")?.value)||0,F=Number(((n-n*o/100)*e).toFixed(2));return this.form.get("total")?.setValue(F,{emitEvent:!1}),Number(this.form.get("total")?.value)||0}static{this.\u0275fac=function(n){return new(n||c)(t.rXU(i.ok),t.rXU(j.k),t.rXU(t.abz),t.rXU(x.xY))}}static{this.\u0275cmp=t.VBU({type:c,selectors:[["app-select-product"]],inputs:{formData:"formData"},outputs:{actionEmitter:"actionEmitter"},standalone:!0,features:[t.OA$,t.aNF],decls:2,vars:2,consts:[[3,"isVisible",4,"ngIf"],["class","space-y-4",4,"ngIf"],[3,"isVisible"],[1,"space-y-4"],["nz-form","",3,"formGroup","nzLayout","ngSubmit"],[1,"font-semibold",3,"nzRequired"],["nzShowSearch","","formControlName","search_input",3,"nzPlaceHolder","nzSize","ngModelChange","nzOnSearch"],[3,"nzLabel",4,"ngFor","ngForOf"],[3,"nzTitle"],[1,"grid","grid-cols-1","md:gap-x-6","md:grid-cols-2","lg:grid-cols-7"],[1,"col-span-2"],[3,"nzRequired"],["nz-input","","disabled","",3,"value"],["formControlName","quantity",1,"w-full",3,"nzMin","nzMax"],["formControlName","discount",1,"w-full",3,"nzMin","nzMax"],["cardTitle",""],[3,"nzLabel"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],[3,"nzValue","nzLabel"],[1,"flex","justify-between","items-center"],[1,"text-lg","font-semibold"],["nz-button","","nzType","primary",3,"disabled"]],template:function(n,o){1&n&&(t.DNE(0,N,1,1,"app-loader",0),t.DNE(1,A,51,48,"div",1)),2&n&&(t.Y8G("ngIf",o.loading),t.R7$(1),t.Y8G("ngIf",!o.loading))},dependencies:[u.MD,u.Sq,u.bT,u.oe,b.V,a.Z,E.Uq,E.e,$.aO,D.c,G.p,V.cK,z.CA,z.Ls,z.Mo,z.zS,C.Sy,P.ld,P.WI,P.uX,q.FG,i.X1,i.qT,i.BC,i.cb,i.j4,i.JD,i.YN,I.h,I.D9]})}}return c})();var J=r(4177),w=r(6475),O=r(4710),X=r(9175),T=r(934),M=r(3190),Q=r(9397),K=r(5154),W=r(1672);function H(c,g){if(1&c&&(t.j41(0,"span",10),t.EFF(1),t.k0s()),2&c){const e=t.XpG();t.R7$(1),t.SpI("#",e.form.controls.invoice_no.value,"")}}function Z(c,g){if(1&c&&t.nrm(0,"app-loader",11),2&c){const e=t.XpG();t.Y8G("isVisible",e.loading)}}function tt(c,g){if(1&c){const e=t.RV6();t.j41(0,"tr",45)(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.nI1(7,"currency"),t.k0s(),t.j41(8,"td"),t.EFF(9),t.k0s(),t.j41(10,"td"),t.EFF(11),t.nI1(12,"currency"),t.k0s(),t.j41(13,"td")(14,"button",46),t.bIt("click",function(){const d=t.eBV(e).index,y=t.XpG(2);return t.Njj(y.editProduct(d))}),t.nrm(15,"i",47),t.k0s(),t.j41(16,"button",48),t.bIt("click",function(){const d=t.eBV(e).index,y=t.XpG(2);return t.Njj(y.removeProduct(d))}),t.nrm(17,"i",49),t.k0s()()()}if(2&c){const e=g.$implicit;let o,d,y,F,S;t.Y8G("formGroupName",g.index),t.R7$(2),t.JRh(null==(o=e.get("product_name"))?null:o.value),t.R7$(2),t.JRh(null==(d=e.get("quantity"))?null:d.value),t.R7$(2),t.JRh(t.brH(7,6,null==(y=e.get("unit_price"))?null:y.value,"\u09f3","symbol")),t.R7$(3),t.JRh(null==(F=e.get("discount"))?null:F.value),t.R7$(2),t.JRh(t.brH(12,10,null==(S=e.get("total"))?null:S.value,"\u09f3","symbol"))}}function et(c,g){1&c&&(t.nrm(0,"nz-empty",50),t.nI1(1,"translate")),2&c&&t.FS9("nzNotFoundContent",t.bMT(1,1,"sales.quick_sale.invoice_table.no_product_added"))}function nt(c,g){1&c&&(t.j41(0,"nz-form-item")(1,"nz-form-label",21),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"nz-form-control"),t.nrm(5,"input",51),t.nI1(6,"translate"),t.k0s()()),2&c&&(t.R7$(1),t.Y8G("nzRequired",!1),t.R7$(1),t.JRh(t.bMT(3,3,"sales.quick_sale.payment_info.note.label")),t.R7$(3),t.FS9("placeholder",t.bMT(6,5,"sales.quick_sale.payment_info.note.placeholder")))}function ot(c,g){1&c&&(t.j41(0,"nz-form-item")(1,"nz-form-label",21),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"nz-form-control"),t.nrm(5,"input",52),t.nI1(6,"translate"),t.k0s()()),2&c&&(t.R7$(1),t.Y8G("nzRequired",!0),t.R7$(1),t.JRh(t.bMT(3,3,"sales.quick_sale.payment_info.payment_reference.label")),t.R7$(3),t.FS9("placeholder",t.bMT(6,5,"sales.quick_sale.payment_info.payment_reference.placeholder")))}function rt(c,g){1&c&&(t.j41(0,"h3",53)(1,"span",54),t.EFF(2,"*"),t.k0s(),t.EFF(3),t.nI1(4,"translate"),t.k0s()),2&c&&(t.R7$(3),t.SpI("",t.bMT(4,1,"sales.quick_sale.payment_info.title")," "))}function it(c,g){if(1&c){const e=t.RV6();t.j41(0,"div")(1,"form",12),t.bIt("ngSubmit",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.confirmSalesInvoice())}),t.j41(2,"app-select-product",13),t.bIt("actionEmitter",function(o){t.eBV(e);const d=t.XpG();return t.Njj(d.handleProductSelect(o))}),t.k0s(),t.j41(3,"nz-table",14)(4,"thead")(5,"tr")(6,"th"),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.j41(9,"th"),t.EFF(10),t.nI1(11,"translate"),t.k0s(),t.j41(12,"th"),t.EFF(13),t.nI1(14,"translate"),t.k0s(),t.j41(15,"th"),t.EFF(16),t.nI1(17,"translate"),t.k0s(),t.j41(18,"th"),t.EFF(19),t.nI1(20,"translate"),t.k0s(),t.j41(21,"th"),t.EFF(22),t.nI1(23,"translate"),t.k0s()()(),t.j41(24,"tbody",15),t.DNE(25,tt,18,14,"tr",16),t.k0s()(),t.DNE(26,et,2,3,"ng-template",null,17,t.C5r),t.j41(28,"div",18)(29,"nz-card",19),t.nI1(30,"translate"),t.j41(31,"div",20)(32,"nz-form-item")(33,"nz-form-label",21),t.EFF(34),t.nI1(35,"translate"),t.k0s(),t.j41(36,"nz-form-control",22),t.nI1(37,"translate"),t.j41(38,"nz-input-group",23),t.nrm(39,"input",24),t.nI1(40,"translate"),t.k0s()()(),t.j41(41,"nz-form-item")(42,"nz-form-label"),t.EFF(43),t.nI1(44,"translate"),t.k0s(),t.j41(45,"nz-form-control",22),t.nI1(46,"translate"),t.j41(47,"nz-input-group",25),t.nrm(48,"input",26),t.nI1(49,"translate"),t.k0s()()(),t.j41(50,"nz-form-item")(51,"nz-form-label"),t.EFF(52),t.nI1(53,"translate"),t.k0s(),t.j41(54,"nz-form-control")(55,"nz-input-group",27),t.nrm(56,"input",28),t.nI1(57,"translate"),t.k0s()()(),t.j41(58,"nz-form-item")(59,"nz-form-label"),t.EFF(60),t.nI1(61,"translate"),t.k0s(),t.j41(62,"nz-form-control",22),t.nI1(63,"translate"),t.j41(64,"nz-input-group",29),t.nrm(65,"input",30),t.nI1(66,"translate"),t.k0s()()()()(),t.j41(67,"nz-card",31)(68,"div",20)(69,"nz-form-item")(70,"nz-form-label",21),t.EFF(71),t.nI1(72,"translate"),t.k0s(),t.j41(73,"nz-form-control")(74,"nz-radio-group",32)(75,"label",33),t.EFF(76),t.nI1(77,"translate"),t.k0s(),t.j41(78,"label",34),t.EFF(79),t.nI1(80,"translate"),t.k0s()()()(),t.DNE(81,nt,7,7,"nz-form-item",9),t.DNE(82,ot,7,7,"nz-form-item",9),t.j41(83,"nz-form-item",35)(84,"nz-form-label",21),t.EFF(85),t.nI1(86,"translate"),t.k0s(),t.j41(87,"nz-form-control")(88,"nz-radio-group",36)(89,"label",37),t.EFF(90),t.nI1(91,"translate"),t.k0s(),t.j41(92,"label",38),t.EFF(93),t.nI1(94,"translate"),t.k0s(),t.j41(95,"label",39),t.EFF(96),t.nI1(97,"translate"),t.k0s()()()()()(),t.DNE(98,rt,5,3,"ng-template",null,40,t.C5r),t.k0s(),t.j41(100,"div",41)(101,"div",42)(102,"button",43),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.saveAsDraft())}),t.EFF(103),t.nI1(104,"translate"),t.k0s(),t.j41(105,"button",44),t.EFF(106),t.nI1(107,"translate"),t.k0s()()()()()}if(2&c){const e=t.sdS(27),n=t.sdS(99),o=t.XpG();let d,y;t.R7$(1),t.Y8G("formGroup",o.form)("nzLayout","vertical"),t.R7$(1),t.Y8G("formData",o.editingProduct),t.R7$(1),t.Y8G("nzData",o.productRows)("nzBordered",!0)("nzShowPagination",!1)("nzSize","small")("nzNoResult",e),t.R7$(4),t.JRh(t.bMT(8,45,"sales.quick_sale.invoice_table.product_name")),t.R7$(3),t.JRh(t.bMT(11,47,"sales.quick_sale.invoice_table.quantity")),t.R7$(3),t.JRh(t.bMT(14,49,"sales.quick_sale.invoice_table.unit_price")),t.R7$(3),t.JRh(t.bMT(17,51,"sales.quick_sale.invoice_table.discount")),t.R7$(3),t.JRh(t.bMT(20,53,"sales.quick_sale.invoice_table.total_price")),t.R7$(3),t.JRh(t.bMT(23,55,"sales.quick_sale.invoice_table.actions")),t.R7$(3),t.Y8G("ngForOf",o.products.controls),t.R7$(4),t.FS9("nzTitle",t.bMT(30,57,"sales.quick_sale.customer_info.title")),t.R7$(4),t.Y8G("nzRequired",!0),t.R7$(1),t.JRh(t.bMT(35,59,"sales.quick_sale.customer_info.customer_name.label")),t.R7$(2),t.FS9("nzErrorTip",t.bMT(37,61,"sales.quick_sale.customer_info.customer_name.error_msg")),t.R7$(3),t.FS9("placeholder",t.bMT(40,63,"sales.quick_sale.customer_info.customer_name.placeholder")),t.R7$(4),t.JRh(t.bMT(44,65,"sales.quick_sale.customer_info.customer_phone.label")),t.R7$(2),t.FS9("nzErrorTip",t.bMT(46,67,"sales.quick_sale.customer_info.customer_phone.error_msg")),t.R7$(3),t.FS9("placeholder",t.bMT(49,69,"sales.quick_sale.customer_info.customer_phone.placeholder")),t.R7$(4),t.JRh(t.bMT(53,71,"sales.quick_sale.customer_info.customer_address.label")),t.R7$(4),t.FS9("placeholder",t.bMT(57,73,"sales.quick_sale.customer_info.customer_address.placeholder")),t.R7$(4),t.JRh(t.bMT(61,75,"sales.quick_sale.customer_info.customer_email.label")),t.R7$(2),t.FS9("nzErrorTip",t.bMT(63,77,"sales.quick_sale.customer_info.customer_email.error_msg")),t.R7$(3),t.FS9("placeholder",t.bMT(66,79,"sales.quick_sale.customer_info.customer_email.placeholder")),t.R7$(2),t.Y8G("nzTitle",n)("nzBordered",!0),t.R7$(3),t.Y8G("nzRequired",!0),t.R7$(1),t.JRh(t.bMT(72,81,"sales.quick_sale.payment_info.payment_method.label")),t.R7$(5),t.JRh(t.bMT(77,83,"sales.quick_sale.payment_info.payment_method.options.cash")),t.R7$(3),t.JRh(t.bMT(80,85,"sales.quick_sale.payment_info.payment_method.options.bkash")),t.R7$(2),t.Y8G("ngIf","bkash"!==(null==(d=o.form.get("payment_method"))?null:d.value)),t.R7$(1),t.Y8G("ngIf","bkash"===(null==(y=o.form.get("payment_method"))?null:y.value)),t.R7$(2),t.Y8G("nzRequired",!0),t.R7$(1),t.JRh(t.bMT(86,87,"sales.quick_sale.payment_info.payment_status.label")),t.R7$(5),t.JRh(t.bMT(91,89,"sales.quick_sale.payment_info.payment_status.options.unpaid")),t.R7$(3),t.JRh(t.bMT(94,91,"sales.quick_sale.payment_info.payment_status.options.partially_paid")),t.R7$(3),t.JRh(t.bMT(97,93,"sales.quick_sale.payment_info.payment_status.options.paid")),t.R7$(6),t.Y8G("disabled",0===o.products.length),t.R7$(1),t.SpI(" ",t.bMT(104,95,"common.action.save_as_draft")," "),t.R7$(2),t.Y8G("disabled",o.form.invalid||0===o.products.length),t.R7$(1),t.SpI(" ",t.bMT(107,97,"common.action.generate_invoice")," ")}}let at=(()=>{class c{constructor(e,n,o,d,y,F,S,st,lt){this._httpService=e,this._destroyRef=n,this._location=o,this._notificationService=d,this._fb=y,this._modal=F,this._router=S,this._activatedRoute=st,this._printService=lt,this.invoiceId=null,this.productList=[],this.selectedProducts=[],this.loading=!1,this.isFilter=!1,this.editingProduct=null,this.selectedProductIndex=null}ngOnInit(){this.form=this.createForm(),this.invoiceId?this.loadInvoiceDetails():this.loadInvoiceNumber(),this.form.get("payment_method")?.valueChanges.subscribe(e=>{const n=this.form.get("payment_reference");"bkash"===e?n?.setValidators([i.k0.required]):(n?.clearValidators(),n?.setValue(null)),n?.updateValueAndValidity()})}createForm(){return this._fb.group({oid:[null],invoice_no:[null,[i.k0.required]],customer_name:[null],customer_phone:[null],customer_address:[null],customer_email:[null],payment_method:["cash",i.k0.required],payment_reference:[null],payment_status:["paid",i.k0.required],notes:[null],status:["Draft"],total_amount:[0,[i.k0.required,i.k0.min(0)]],products:this._fb.array([])})}createProductGroup(e=null){return this._fb.group({inventory_oid:[e?.inventory_oid??null,i.k0.required],product_name:[e?.product_name??null,i.k0.required],product_oid:[e?.product_oid??null,i.k0.required],quantity_available:[e?.quantity_available??null],quantity:[e?.quantity??1,[i.k0.required,i.k0.min(1)]],unit_price:[e?.unit_price??null,[i.k0.required,i.k0.min(0)]],discount:[e?.discount??0],total:[e?.total??0,i.k0.required]})}get products(){return this.form.get("products")}get productRows(){return this.products.value}addProduct(){this.products.push(this.createProductGroup())}removeProduct(e){this.products.removeAt(e)}generateInvoice(e){this.loading=!0,this._httpService.post(l.A.CONFIRM_SALES_INVOICE,e).pipe((0,s.pQ)(this._destroyRef),(0,h.j)(()=>this.loading=!1)).subscribe({next:n=>{200===n.status?(this._notificationService.success("Success","Invoice generated successfully"),this._printService.printReceipt(e).then(()=>{this.invoiceId&&this.resetToPlainQuickSaleRoute(),this.resetForm()})):this._notificationService.error("Error",n.message)},error:n=>{console.log(n),this._notificationService.error("Error!",n?.error?.message)}})}confirmSalesInvoice(){if(this.form.valid)if(this.form.patchValue({status:"Purchased"}),this.form.valid||0===this.products.length){const e=this.form.getRawValue();this.displayConfirmationModal(e,"confirm")}else this._notificationService.error("Error","Cannot confirm invoice due to invalid data");else(0,k.N4)(this.form),this._notificationService.error("Error","Please fill all required fields before confirming the invoice.")}handleProductSelect(e){const{action:n,value:o}=e;switch(n){case"add":this.addProductToInvoice(o);break;case"update":this.updateProductInInvoice(o);break;default:console.warn(`Unhandled action: ${n}`)}}addProductToInvoice(e){this.products.controls.some(o=>o.get("inventory_oid")?.value===e.inventory_oid)?this._notificationService.warning("Product already exists","This product is already added to the invoice."):(this.products.push(this.createProductGroup(e)),this.updateTotalAmount())}updateTotalAmount(){const e=this.products.controls.reduce((n,o)=>n+(Number(o.get("total")?.value)||0),0);this.form.get("total_amount")?.setValue(e)}removeProductFromInvoice(e){-1!==e&&(this.products.removeAt(e),this.updateTotalAmount())}updateProductInInvoice(e){const n=this.products.controls.findIndex(o=>o.get("inventory_oid")?.value===e.inventory_oid);-1!==n?(this.products.at(n).patchValue({quantity:e.quantity,unit_price:e.unit_price,discount:e.discount,total:e.total,quantity_available:e.quantity_available,inventory_oid:e.inventory_oid}),this.updateTotalAmount(),this.selectedProductIndex=null,this.editingProduct=null):(this.addProductToInvoice(e),console.warn(`Product with OID ${e.inventory_oid} not found for update.`))}editProduct(e){const n=this.products.at(e).value;this.selectedProductIndex=e,this.editingProduct=n}resetForm(){this.form.reset({oid:null,invoice_no:null,customer_name:null,customer_phone:null,customer_address:null,customer_email:null,payment_method:"cash",payment_reference:null,payment_status:"paid",notes:null,status:"Draft",total_amount:0,products:[]}),this.products.clear(),this.loadInvoiceNumber(),this.updateTotalAmount()}saveAsDraft(){if(this.form)if(this.form.patchValue({status:"Draft"}),this.form.valid||0===this.products.length){const e=this.form.getRawValue();this.displayConfirmationModal(e,"draft")}else this._notificationService.error("Error","Cannot save draft due to invalid data")}loadInvoiceNumber(){this.loading=!0,this._httpService.get(l.A.GET_INVOICE_NUMBER_FOR_SALE).pipe((0,s.pQ)(this._destroyRef),(0,h.j)(()=>this.loading=!1)).subscribe({next:e=>{200===e.status&&(e.body?.data&&e.body?.data.invoice_no?this.form.get("invoice_no")?.setValue(e.body.data.invoice_no):this._notificationService.error("Error","Invoice number not found in response"))},error:e=>{console.log(e),this._notificationService.error("Error!",e?.error?.message)}})}loadInvoiceDetails(){this.loading=!0,this._httpService.get(l.A.GET_INVOICE_DETAILS,{oid:this.invoiceId}).pipe((0,s.pQ)(this._destroyRef),(0,h.j)(()=>this.loading=!1)).subscribe({next:e=>{200===e.status&&this.patchInvoiceForm(e.body.data)},error:e=>{console.log(e),this._notificationService.error("Error!",e?.error?.message),this.resetToPlainQuickSaleRoute()}})}patchInvoiceForm(e){this.form.patchValue({oid:e.oid,invoice_no:e.invoice_no,customer_name:e.customer_name,customer_phone:e.customer_phone,customer_address:e.customer_address,customer_email:e.customer_email,payment_method:e.payment_method,payment_reference:e.payment_reference,payment_status:e.payment_status,notes:e.notes,status:e.status,total_amount:e.total_amount}),this.products.clear(),e.products.forEach(n=>{this.products.push(this.createProductGroup(n))}),this.updateTotalAmount()}resetToPlainQuickSaleRoute(){this._router.navigate(["../quick-sale"],{relativeTo:this._activatedRoute.parent,replaceUrl:!0})}saveInvoiceInDraft(e){this.loading=!0,this._httpService.post(l.A.SAVE_INVOICE_IN_DRAFT,e).pipe((0,s.pQ)(this._destroyRef),(0,h.j)(()=>this.loading=!1)).subscribe({next:n=>{200===n.status?this.invoiceId?this.resetToPlainQuickSaleRoute():(this.resetForm(),this.products.clear(),this.loadInvoiceNumber(),this.updateTotalAmount(),this._notificationService.success("Success","Invoice saved successfully")):this._notificationService.error("Error",n.message)},error:n=>{console.log(n),this._notificationService.error("Error!",n?.error?.message)}})}displayConfirmationModal(e,n){let o;o="draft"===n?"Do you want to save this invoice as a draft?":"Do you want to generate this invoice?",this._modal.create({nzContent:J.M,nzData:{message:o},nzFooter:null,nzClosable:!1,nzOnOk:()=>"draft"===n?this.saveInvoiceInDraft(e):this.generateInvoice(e)})}static{this.\u0275fac=function(n){return new(n||c)(t.rXU(j.k),t.rXU(t.abz),t.rXU(u.aZ),t.rXU(x.xY),t.rXU(i.ok),t.rXU(w.N_),t.rXU(O.Ix),t.rXU(O.nX),t.rXU(X.B))}}static{this.\u0275cmp=t.VBU({type:c,selectors:[["app-quick-sale"]],inputs:{invoiceId:"invoiceId"},standalone:!0,features:[t.aNF],decls:17,vars:15,consts:[[1,"p-4","space-y-4",3,"formGroup"],[1,"flex","justify-between","items-center"],[1,"flex","items-center","space-x-2"],["nz-icon","","nzType","shopping-cart",1,"text-2xl"],[1,"text-2xl","font-bold"],["class","text-base text-gray-500",4,"ngIf"],["nz-button","","nzType","default","nzDanger","","nzSize","small",3,"click"],[1,"text-lg","font-bold"],[3,"isVisible",4,"ngIf"],[4,"ngIf"],[1,"text-base","text-gray-500"],[3,"isVisible"],["nz-form","",1,"space-y-4",3,"formGroup","nzLayout","ngSubmit"],[3,"formData","actionEmitter"],[3,"nzData","nzBordered","nzShowPagination","nzSize","nzNoResult"],["formArrayName","products"],[3,"formGroupName",4,"ngFor","ngForOf"],["noProducts",""],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[3,"nzTitle"],[1,"grid","grid-cols-2","gap-x-4"],[3,"nzRequired"],[3,"nzErrorTip"],["nzPrefixIcon","user"],["nz-input","","formControlName","customer_name",3,"placeholder"],["nzPrefixIcon","phone"],["nz-input","","formControlName","customer_phone",3,"placeholder"],["nzPrefixIcon","home"],["nz-input","","formControlName","customer_address",3,"placeholder"],["nzPrefixIcon","mail"],["nz-input","","formControlName","customer_email",3,"placeholder"],[3,"nzTitle","nzBordered"],["formControlName","payment_method","nzButtonStyle","solid",1,"w-full"],["nz-radio-button","","nzValue","cash",1,"w-1/2","text-center"],["nz-radio-button","","nzValue","bkash",1,"w-1/2","text-center"],[1,"col-span-2"],["formControlName","payment_status","nzButtonStyle","solid",1,"w-full"],["nz-radio-button","","nzValue","unpaid",1,"w-1/3","text-center"],["nz-radio-button","","nzValue","partially_paid",1,"w-1/3","text-center"],["nz-radio-button","","nzValue","paid",1,"w-1/3","text-center"],["paymentTitle",""],[1,"flex","justify-end","items-center"],[1,"flex","space-x-2"],["nz-button","","nzType","default","type","button",3,"disabled","click"],["nz-button","","nzType","primary","type","submit",3,"disabled"],[3,"formGroupName"],["nz-button","","nzType","text","nzShape","circle","type","button","nz-tooltip","","nzTooltipTitle","Edit",3,"click"],["nz-icon","","nzType","edit"],["nz-button","","nzType","text","nzShape","circle","type","button","nz-tooltip","","nzTooltipTitle","Remove","nzDanger","",3,"click"],["nz-icon","","nzType","delete"],[3,"nzNotFoundContent"],["nz-input","","formControlName","notes",3,"placeholder"],["nz-input","","formControlName","payment_reference","required","",3,"placeholder"],[1,"text-lg","font-semibold","flex","gap-2","items-center"],[1,"text-red-500"]],template:function(n,o){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.nrm(3,"i",3),t.j41(4,"h2",4),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.DNE(7,H,2,1,"span",5),t.k0s(),t.j41(8,"div",2)(9,"button",6),t.bIt("click",function(){return o.resetForm()}),t.EFF(10),t.nI1(11,"translate"),t.k0s(),t.j41(12,"p",7),t.EFF(13),t.nI1(14,"currency"),t.k0s()()(),t.DNE(15,Z,1,1,"app-loader",8),t.DNE(16,it,108,99,"div",9),t.k0s()),2&n&&(t.Y8G("formGroup",o.form),t.R7$(5),t.JRh(t.bMT(6,7,"sales.quick_sale.title")),t.R7$(2),t.Y8G("ngIf",o.form.controls.invoice_no.value),t.R7$(3),t.JRh(t.bMT(11,9,"common.action.reset")),t.R7$(3),t.SpI("Total: ",t.brH(14,11,o.form.controls.total_amount.value,"\u09f3","symbol")," "),t.R7$(2),t.Y8G("ngIf",o.loading),t.R7$(1),t.Y8G("ngIf",!o.loading))},dependencies:[u.MD,u.Sq,u.bT,u.oe,a.Z,E.Uq,E.e,$.aO,D.c,G.p,V.cK,z.CA,z.Ls,z.Mo,z.zS,C.Sy,C.tg,T.CP,T.SO,T._4,T.IL,T.aj,T.kt,M.lx,M.fr,M.i3,Q.Dn,K.LH,W.RW,i.YN,i.qT,i.me,i.BC,i.cb,i.YS,f.jl,i.X1,i.j4,i.JD,i.$R,i.v8,b.V,U,I.h,I.D9],styles:[".certain-search-item-count[_ngcontent-%COMP%]{position:absolute;color:#999;right:16px}.more-link[_ngcontent-%COMP%]{float:right}"]})}}return c})()},353:(R,v,r)=>{r.d(v,{j:()=>s});var u=r(177),a=r(7705);let i=(()=>{class l{static{this.\u0275fac=function(m){return new(m||l)}}static{this.\u0275cmp=a.VBU({type:l,selectors:[["app-spinner"]],standalone:!0,features:[a.aNF],decls:3,vars:0,consts:[["fill","none","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"-ml-1","mr-3","h-5","w-5","animate-spin","text-white"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z","fill","currentColor",1,"opacity-75"]],template:function(m,h){1&m&&(a.qSk(),a.j41(0,"svg",0),a.nrm(1,"circle",1)(2,"path",2),a.k0s())},dependencies:[u.MD]})}}return l})();var f=r(7002);function b(l,p){1&l&&(a.j41(0,"span"),a.nrm(1,"app-spinner"),a.k0s())}function t(l,p){if(1&l&&(a.j41(0,"span",4),a.EFF(1),a.k0s()),2&l){const _=a.XpG();a.R7$(1),a.SpI(" ",_.label," ")}}let s=(()=>{class l{constructor(){this.type="button",this.loading=!1}static{this.\u0275fac=function(m){return new(m||l)}}static{this.\u0275cmp=a.VBU({type:l,selectors:[["primary-button"]],inputs:{label:"label",type:"type",loading:"loading"},standalone:!0,features:[a.aNF],decls:4,vars:5,consts:[["disableForGuest","",1,"min-w-min","group","relative","flex","items-center","gap-4","overflow-hidden","rounded-sm","bg-white","px-6","py-2","shadow","font-medium","disabled:cursor-not-allowed",3,"disabled","type"],[1,"absolute","inset-0","w-2","bg-primary","transition-all","duration-300","ease-in-out","group-hover:w-full",3,"ngClass"],[4,"ngIf"],["class","relative z-10 whitespace-nowrap text-black transition-all duration-300 group-hover:text-white",4,"ngIf"],[1,"relative","z-10","whitespace-nowrap","text-black","transition-all","duration-300","group-hover:text-white"]],template:function(m,h){1&m&&(a.j41(0,"button",0),a.nrm(1,"div",1),a.DNE(2,b,2,0,"span",2),a.DNE(3,t,2,1,"span",3),a.k0s()),2&m&&(a.Y8G("disabled",h.loading)("type",h.type),a.R7$(1),a.Y8G("ngClass",h.loading?"w-full":""),a.R7$(1),a.Y8G("ngIf",h.loading),a.R7$(1),a.Y8G("ngIf",!h.loading))},dependencies:[u.MD,u.YU,u.bT,i,f.x]})}}return l})()},9475:(R,v,r)=>{r.d(v,{t:()=>i});var u=r(177),a=r(7705);let i=(()=>{class f{constructor(){this.type="button"}static{this.\u0275fac=function(s){return new(s||f)}}static{this.\u0275cmp=a.VBU({type:f,selectors:[["secondary-button"]],inputs:{label:"label",type:"type"},standalone:!0,features:[a.aNF],decls:4,vars:1,consts:[["type","button",1,"min-w-min","group","relative","flex","items-center","gap-4","overflow-hidden","rounded-sm","bg-white","px-6","py-2","shadow","font-medium","disabled:cursor-wait"],[1,"absolute","inset-0","w-2","bg-[#8D99AE]","transition-all","duration-300","ease-in-out","group-hover:w-full"],[1,"relative","z-10","whitespace-nowrap","text-black","transition-all","duration-300","group-hover:text-white"]],template:function(s,l){1&s&&(a.j41(0,"button",0),a.nrm(1,"div",1),a.j41(2,"span",2),a.EFF(3),a.k0s()()),2&s&&(a.R7$(3),a.SpI(" ",l.label," "))},dependencies:[u.MD]})}}return f})()},4177:(R,v,r)=>{r.d(v,{M:()=>l});var u=r(177),a=r(7109),i=r(5088),f=r(6475),b=r(353),t=r(9475),s=r(7705);let l=(()=>{class p{constructor(m,h){this.modalData=m,this._modalRef=h}handleConfirm(){this._modalRef.triggerOk()}closeModal(){this._modalRef.triggerCancel()}static{this.\u0275fac=function(h){return new(h||p)(s.rXU(f.or),s.rXU(f.J9))}}static{this.\u0275cmp=s.VBU({type:p,selectors:[["app-confirmation-modal"]],standalone:!0,features:[s.aNF],decls:7,vars:5,consts:[[1,"w-full","flex","flex-col","items-center","p-5"],["src","assets/icons/undraw_confirmation.svg","alt","",1,"w-2/3","mx-auto"],[1,"text-black","mt-6","mb-9","font-semibold","text-lg"],[1,"flex","items-center","gap-8"],[3,"label","type","click"]],template:function(h,k){1&h&&(s.j41(0,"div",0),s.nrm(1,"img",1),s.j41(2,"p",2),s.EFF(3),s.k0s(),s.j41(4,"div",3)(5,"secondary-button",4),s.bIt("click",function(){return k.closeModal()}),s.k0s(),s.j41(6,"primary-button",4),s.bIt("click",function(){return k.handleConfirm()}),s.k0s()()()),2&h&&(s.R7$(3),s.JRh(k.modalData.message),s.R7$(2),s.Y8G("label","Cancel")("type","button"),s.R7$(1),s.Y8G("label","Confirm")("type","button"))},dependencies:[u.MD,a.Z,i.iu,b.j,t.t]})}}return p})()},765:(R,v,r)=>{r.d(v,{V:()=>f});var u=r(177),a=r(7705);function i(b,t){1&b&&(a.j41(0,"div",1),a.nrm(1,"span")(2,"span")(3,"span")(4,"span")(5,"span"),a.k0s())}let f=(()=>{class b{constructor(){this.isVisible=!1,this.showLoader=!1}ngOnInit(){this.isVisible&&(this.showLoader=!0,setTimeout(()=>{this.showLoader=!1},500))}static{this.\u0275fac=function(l){return new(l||b)}}static{this.\u0275cmp=a.VBU({type:b,selectors:[["app-loader"]],inputs:{isVisible:"isVisible"},standalone:!0,features:[a.aNF],decls:1,vars:1,consts:[["class","loading",4,"ngIf"],[1,"loading"]],template:function(l,p){1&l&&a.DNE(0,i,6,0,"div",0),2&l&&a.Y8G("ngIf",p.isVisible)},dependencies:[u.MD,u.bT],styles:[".loading[_ngcontent-%COMP%]{--speed-of-animation: .9s;--gap: 6px;--first-color: #4c86f9;--second-color: #49a84c;--third-color: #f6bb02;--fourth-color: #f6bb02;--fifth-color: #2196f3;display:flex;justify-content:center;align-items:center;gap:6px}.loading[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:4px;height:50px;background:var(--first-color);animation:_ngcontent-%COMP%_scale var(--speed-of-animation) ease-in-out infinite}.loading[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){background:var(--second-color);animation-delay:-.8s}.loading[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(3){background:var(--third-color);animation-delay:-.7s}.loading[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(4){background:var(--fourth-color);animation-delay:-.6s}.loading[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(5){background:var(--fifth-color);animation-delay:-.5s}@keyframes _ngcontent-%COMP%_scale{0%,40%,to{transform:scaleY(.05)}20%{transform:scaleY(1)}}"]})}}return b})()},7002:(R,v,r)=>{r.d(v,{x:()=>i});var u=r(7705),a=r(3769);let i=(()=>{class f{constructor(t,s,l){this.el=t,this.renderer=s,this.authService=l}ngOnInit(){this.authService.getGuestUserStatus()&&this.renderer.setAttribute(this.el.nativeElement,"disabled","true")}static{this.\u0275fac=function(s){return new(s||f)(u.rXU(u.aKT),u.rXU(u.sFG),u.rXU(a.u))}}static{this.\u0275dir=u.FsC({type:f,selectors:[["","disableForGuest",""]],standalone:!0})}}return f})()}}]);